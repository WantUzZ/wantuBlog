<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="关于程序与设计、黑客与画家 | 王涛，Web & Mobile Lover，Software Engineer，UX Designer | 这里是 @want王涛 的个人博客，与你一起发现更大的世界。">
    <meta name="keywords"  content="王涛, want王涛, want, huxpro, @huxpro, 王涛的博客, Hux Blog, 博客, 个人网站, 互联网, Web, JavaScript, 大数据">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="数据可视化--jQuery datatables - 老王 | want">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="前言
数据可视化就是借助图形化手段将原本冷冰冰的数据生动的传达给用户。用户能够轻松的获取有价值的数据并及时的做出相应的决策支撑。
目前接触到的数据表示形式有一下几点：
1、表格
2、常见的统计图行（柱状、条形、饼图、折线，雷达等）
3、关系图（连通图）
那么有哪些技术可以轻松的帮助我们对以上需求进行处理呢？
1、jQuery的datatables
2、ECharts、D3.js
3、cyto...">
    
    <meta property="article:published_time" content="2018-10-26T03:43:00Z">
    
    
    <meta property="article:author" content="wantu">
    
    
    <meta property="article:tag" content="数据可视化">
    
    <meta property="article:tag" content="jQuery Datatables">
    
    
    <meta property="og:image" content="http://localhost:4000/img/wantu.jpg">
    <meta property="og:url" content="http://localhost:4000/2018/10/26/showData-datatables/">
    <meta property="og:site_name" content="老王 | want">
    
    <title>数据可视化--jQuery datatables - 老王 | want</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2018/10/26/showData-datatables/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


  <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    //新增访问次数
    function addCount(Counter) {
      // 页面（博客文章）中的信息：leancloud_visitors
      // id为page.url， data-flag-title为page.title
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("visited_times");// 将点击次数加1
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                var newTimes = counter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            // 执行这里，说明LeanCloud中还没有记录此文章
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("post_title", title);// 把文章标题
            newcounter.set("post_url", url); // 文章url
            newcounter.set("visited_times", 1); // 初始点击次数：1次
            newcounter.save(null, { // 上传到LeanCloud服务器中
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                var newTimes = newcounter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //仅根据url和title查出当前访问次数，不做+1操作
    function showCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            var $element = $(document.getElementById(url));
            var newTimes = counter.get('visited_times');
            $element.find('.leancloud-visitors-count').text(newTimes);
          } else {
            //如果表里没查到记录，那就是异常情况了
            console.log('异常情况，不应该没记录的');
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //调用API获取IP
    function getVisitorIpAndJudge() {
      var ip;
      var options = {
        type: 'POST',
        dataType: "json",
        //async: false, //jquery3中可以直接使用回调函数，不用再指定async
        url: "https://freegeoip.net/json/?callback=?"
      };
      $.ajax(options)
      .done(function(data, textStatus, jqXHR) {
        if(textStatus == "success") {
          ip = data.ip;
        }
        judgeVisitor(ip)
      });
    }

    //判断访客是否已访问过该文章，及访问时间，符合条件则增加一次访问次数
    function judgeVisitor(ip) {
      var Counter = AV.Object.extend("visited_times");
      var Visitor = AV.Object.extend("visitors_record");

      var $postInfo = $(".leancloud_visitors");
      var post_url = $postInfo.attr('id').trim();

      var query = new AV.Query(Visitor);

      query.equalTo("visitor_ip", ip);
      query.equalTo("post_url", post_url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            console.log('该IP已访问过该文章');

            var oldVisitor = results[0];

            var lastTime = oldVisitor.updatedAt;
            var curTime = new Date();

            var timePassed = curTime.getTime() - lastTime.getTime();

            if(timePassed > 1 * 60 * 1000) {
              console.log('距离该IP上一次访问该文章已超过了1分钟，更新访问记录，并增加访问次数');

              addCount(Counter);

              oldVisitor.fetchWhenSave(true);
              oldVisitor.save(null, {
                success: function(oldVisitor) { },
                error: function(oldVisitor, error) {
                  console.log('Failed to save visitor record, with error message: ' + error.message);
                }
              });
            } else {
              console.log('这是该IP 1分钟内重复访问该文章，不更新访问记录，不增加访问次数');
              showCount(Counter);
            }
          } else {
            console.log('该IP第一次访问该文章，保存新的访问记录，并增加访问次数');

            addCount(Counter);

            var newVisitor = new Visitor();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newVisitor.setACL(acl);
            newVisitor.set("visitor_ip", ip);
            newVisitor.set("post_url", post_url);
            newVisitor.save(null, { // 上传到LeanCloud服务器中
              success: function(newVisitor) { },
              error: function(newVisitor, error) {
                console.log('Failed to create visitor record, with error message: ' + error.message);
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
          addCount(Counter);
        }
      });
    }

    $(function() {
      if ($('.leancloud_visitors').length == 1) {
        // 文章页面，调用判断方法，对符合条件的访问增加访问次数
        getVisitorIpAndJudge();
      } else if ($('.post-link').length > 1){
        // 首页 暂未使用
        // showHitCount(Counter);
      }
    });
  </script>

<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">want</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        <a href="/portfolio/">你好</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/star1.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/star1.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96" title="数据可视化">数据可视化</a>
                        
                        <a class="tag" href="/archive/?tag=jQuery+Datatables" title="jQuery Datatables">jQuery Datatables</a>
                        
                    </div>
                    <h1>数据可视化--jQuery datatables</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by wantu on October 26, 2018</span>
                </div>
            </div>
        </div>
    </div>
</header>





<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

                <h2 id="前言">前言</h2>
<p>数据可视化就是借助图形化手段将原本冷冰冰的数据生动的传达给用户。用户能够轻松的获取有价值的数据并及时的做出相应的决策支撑。<br />
目前接触到的数据表示形式有一下几点：<br />
1、表格<br />
2、常见的统计图行（柱状、条形、饼图、折线，雷达等）<br />
3、关系图（连通图）<br />
那么有哪些技术可以轻松的帮助我们对以上需求进行处理呢？<br />
1、jQuery的datatables<br />
2、ECharts、D3.js<br />
3、cytoscape.js<br /></p>

<h2 id="正文">正文</h2>
<p><strong>jQuery的DataTables</strong>
表格是一种常见的数据组织形式。对标的部门应该是财务部吧，因为财务每天都要接触大量的报表。企业数据部门从数据库抓取相关数据进行一系列的运算处理将数据以报表的形式提供给财务部门是一种常见的需求形式。<br />
原先是如何制作表格的呢？我们知道html中有一个table标签，这个是我实习前接触最多的关于表格功能的解决办法。但是table标签使用是非的麻烦需要我们手动的组装dom。并且table不够灵活，往往对一些常用的需求（对每列进行求和，排序，分页，数据导出）的解决比较麻烦。<br />
那么请尝试使用jQuery的datatables吧。
它提供灵活和强大的api。</p>

<h4 id="使用">使用</h4>
<blockquote>
  <p>引入css和js文件</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/css"</span>
          <span class="nx">href</span><span class="o">=</span><span class="s2">"https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/b-1.4.2/b-html5-1.4.2/datatables.min.css"</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/javascript"</span>
            <span class="nx">src</span><span class="o">=</span><span class="s2">"https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/b-1.4.2/b-html5-1.4.2/datatables.min.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>在相关的前端界面声明一个table标签<br /></p>
</blockquote>

<p>注意table标签中的内容是可选的，也就是说thead tbody 这两个标签是可选的。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">table</span> <span class="kd">class</span><span class="o">=</span><span class="s2">"table b-t"</span>  <span class="nx">id</span><span class="o">=</span><span class="s2">"t1"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/table</span><span class="err">&gt;
</span></pre></td></tr></tbody></table></code></pre></div></div>
<blockquote>
  <p>js文件中对datatables进行初始化操作</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre></td><td class="rouge-code"><pre><span class="c1">//最基本的样子</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'# t1'</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'#datatables'</span><span class="p">).</span><span class="nx">dataTable</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="p">});</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">//一个工作中的例子 </span>
<span class="c1">//一定注意以下列设置中的对象数组中每个对象的data属性的值一定要和数据库查询出来的列名对上！</span>
<span class="nx">oTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#sales-details'</span><span class="p">).</span><span class="nx">DataTable</span><span class="p">({</span>
            <span class="s2">"ajax"</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1">//请求数据</span>
                <span class="na">url</span><span class="p">:</span> <span class="s2">"/api/brand/sales"</span><span class="p">,</span>
                <span class="c1">//数据返回格式</span>
                <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="c1">//请求方式</span>
                <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
                <span class="c1">//请求携带参数</span>
                <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                	<span class="p">...</span>
                <span class="p">},</span>
                <span class="c1">//对返回的数据进行处理，其中可以出发其他的一些数据可视化的工具，比如说echarts。对于要展示的数据，对其进行return。</span>
                <span class="na">dataSrc</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">'success'</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">//data对象中的detail属性的值是我们想要展示在datatables上的。</span>
                        <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">details</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nx">BootstrapDialog</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
							<span class="na">title</span><span class="p">:</span> <span class="s1">'服务器返回错误'</span><span class="p">,</span>
							<span class="na">message</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
						<span class="p">});</span>
                        <span class="k">return</span> <span class="p">[];</span>
                    <span class="p">}</span>


                <span class="p">},</span>
                <span class="c1">//错误处理</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                    <span class="nx">BootstrapDialog</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span><span class="na">title</span><span class="p">:</span> <span class="s1">'Error'</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">error</span><span class="p">)});</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="c1">//绘制结束触发的回调</span>
            <span class="s2">"fnDrawCallback"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">oSettings</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">...</span>
            <span class="p">},</span>
            <span class="s2">"processing"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">"iDisplayLength"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s2">"aaSorting"</span><span class="p">:</span> <span class="p">[[</span><span class="mi">6</span><span class="p">,</span> <span class="s2">"desc"</span><span class="p">]],</span>
            <span class="c1">//国际化操作</span>
            <span class="s2">"oLanguage"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"sLengthMenu"</span><span class="p">:</span> <span class="s2">"显示 _MENU_ 记录"</span><span class="p">,</span>
                <span class="s2">"sEmptyTable"</span><span class="p">:</span> <span class="s2">"未有相关数据"</span><span class="p">,</span>
                <span class="s2">"sInfo"</span><span class="p">:</span> <span class="s2">"当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录。"</span><span class="p">,</span>
                <span class="s2">"sInfoEmpty"</span><span class="p">:</span> <span class="s2">"当前显示0到0条，共0条记录"</span><span class="p">,</span>
                <span class="s2">"sInfoFiltered"</span><span class="p">:</span> <span class="s2">"（数据库中共为 _MAX_ 条记录）"</span><span class="p">,</span>
                <span class="s2">"sSearch"</span><span class="p">:</span> <span class="s2">"模糊查询："</span><span class="p">,</span>
                <span class="s2">"bDeferRender"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="s2">"sUrl"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
                <span class="s2">"oPaginate"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"sFirst"</span><span class="p">:</span> <span class="s2">"首页"</span><span class="p">,</span>
                    <span class="s2">"sPrevious"</span><span class="p">:</span> <span class="s2">" 上一页 "</span><span class="p">,</span>
                    <span class="s2">"sNext"</span><span class="p">:</span> <span class="s2">" 下一页 "</span><span class="p">,</span>
                    <span class="s2">"sLast"</span><span class="p">:</span> <span class="s2">" 尾页 "</span>
                <span class="p">},</span>
                <span class="s2">"oAria"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"sSortAscending"</span><span class="p">:</span> <span class="s2">" - click/return to sort ascending"</span><span class="p">,</span>
                    <span class="s2">"sSortDescending"</span><span class="p">:</span> <span class="s2">" - click/return to sort descending"</span>
                <span class="p">}</span>

            <span class="p">},</span>
            <span class="s1">'dom'</span><span class="p">:</span> <span class="s1">'&lt;"float_left"B&gt;&lt;"float_right"f&gt;rt&lt;"float_left"i&gt;&lt;"float_right"p&gt;'</span><span class="p">,</span>
            <span class="c1">//数据导出</span>
            <span class="s2">"buttons"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="na">extend</span><span class="p">:</span> <span class="s1">'csv'</span><span class="p">,</span>
                <span class="na">text</span><span class="p">:</span> <span class="s1">'导出csv'</span><span class="p">,</span>
                <span class="na">className</span><span class="p">:</span> <span class="s1">'btn btn-info'</span><span class="p">,</span>
                <span class="na">charSet</span><span class="p">:</span> <span class="s2">"utf8"</span>
            <span class="p">},</span> <span class="p">{</span>
                <span class="na">extend</span><span class="p">:</span> <span class="s1">'excel'</span><span class="p">,</span>
                <span class="na">text</span><span class="p">:</span> <span class="s1">'导出excel'</span><span class="p">,</span>
                <span class="na">className</span><span class="p">:</span> <span class="s1">'btn btn-info'</span>

            <span class="p">}],</span>
            <span class="c1">//列设置</span>
            <span class="s2">"aoColumns"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"城市"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"city_name"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"店铺"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"store_name"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"地址"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"address"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"商品"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"goods_name"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"购买量(散装)"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"amount"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"购买金额"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"asum"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"送达时间"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"arrived_time"</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="c1">//特殊列数据处理 对第7列（从0开始）的值进行时间的格式化</span>
            <span class="s2">"aoColumnDefs"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">'aTargets'</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">'mRender'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">'YYYY-MM-DD HH:mm:ss'</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>

        <span class="p">});</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>以上是关于jQuery的datatables的简单的使用。<br /></p>
<h4 id="表格底部新增总计">表格底部新增总计</h4>
<p><img src="/img/xzhj.jpg" alt="查询执行路径图" />
<strong>首先在table体中加上tfoot</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">table</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"sales-details"</span>
               <span class="kd">class</span><span class="o">=</span><span class="s2">"table-condensed font-small table-hover table-striped dataTable no-footer"</span> <span class="nx">cellspacing</span><span class="o">=</span><span class="s2">"0"</span>
               <span class="nx">width</span><span class="o">=</span><span class="s2">"100%"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tfoot</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="err">合计</span><span class="o">&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&lt;</span><span class="sr">/th</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tr</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="sr">/tfoot</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/table</span><span class="err">&gt;
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>在option中新增一个footerCallback:写上一个回调函数。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
</pre></td><td class="rouge-code"><pre><span class="nx">oTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#sales-details'</span><span class="p">).</span><span class="nx">DataTable</span><span class="p">({</span>
            <span class="s2">"ajax"</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">url</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
                <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">start_date_no1</span><span class="p">:</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#start-date-no1'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">||</span><span class="s1">''</span><span class="p">,</span>
                    <span class="na">end_date_no1</span><span class="p">:</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#end-date-no1'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">||</span> <span class="s1">''</span><span class="p">,</span>
                    <span class="na">cityIds</span><span class="p">:</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#city-select'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">||</span><span class="s1">''</span>
                <span class="p">},</span>
                <span class="na">dataSrc</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">'success'</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">echart9_data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">BootstrapDialog</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
                            <span class="na">title</span><span class="p">:</span> <span class="s1">'服务器返回错误'</span><span class="p">,</span>
                            <span class="na">message</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
                        <span class="p">});</span>
                        <span class="k">return</span> <span class="p">[];</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
                    <span class="nx">BootstrapDialog</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span><span class="na">title</span><span class="p">:</span> <span class="s1">'Error'</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span><span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">()})</span>
                <span class="p">},</span>
                 <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">oSettings</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//console.log('wantu.....');</span>
                     <span class="c1">//draw_echart9(echart9_data);</span>
                 <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">"processing"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">"iDisplayLength"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="c1">//默认对第7列进行降序排</span>
            <span class="s2">"aaSorting"</span><span class="p">:</span> <span class="p">[[</span><span class="mi">6</span><span class="p">,</span> <span class="s2">"desc"</span><span class="p">]],</span>
            <span class="s2">"oLanguage"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"sLengthMenu"</span><span class="p">:</span> <span class="s2">"显示 _MENU_ 记录"</span><span class="p">,</span>
                <span class="s2">"sEmptyTable"</span><span class="p">:</span> <span class="s2">"未有相关数据"</span><span class="p">,</span>
                <span class="s2">"sInfo"</span><span class="p">:</span> <span class="s2">"当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录。"</span><span class="p">,</span>
                <span class="s2">"sInfoEmpty"</span><span class="p">:</span> <span class="s2">"当前显示0到0条，共0条记录"</span><span class="p">,</span>
                <span class="s2">"sInfoFiltered"</span><span class="p">:</span> <span class="s2">"（数据库中共为 _MAX_ 条记录）"</span><span class="p">,</span>
                <span class="s2">"sSearch"</span><span class="p">:</span> <span class="s2">"模糊查询："</span><span class="p">,</span>
                <span class="s2">"bDeferRender"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="s2">"sUrl"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
                <span class="s2">"oPaginate"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"sFirst"</span><span class="p">:</span> <span class="s2">"首页"</span><span class="p">,</span>
                    <span class="s2">"sPrevious"</span><span class="p">:</span> <span class="s2">" 上一页 "</span><span class="p">,</span>
                    <span class="s2">"sNext"</span><span class="p">:</span> <span class="s2">" 下一页 "</span><span class="p">,</span>
                    <span class="s2">"sLast"</span><span class="p">:</span> <span class="s2">" 尾页 "</span>
                <span class="p">},</span>
                <span class="s2">"oAria"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"sSortAscending"</span><span class="p">:</span> <span class="s2">" - click/return to sort ascending"</span><span class="p">,</span>
                    <span class="s2">"sSortDescending"</span><span class="p">:</span> <span class="s2">" - click/return to sort descending"</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">'dom'</span><span class="p">:</span> <span class="s1">'&lt;"float_left"B&gt;&lt;"float_right"f&gt;rt&lt;"float_left"i&gt;&lt;"float_right"p&gt;'</span><span class="p">,</span>
            <span class="s2">"buttons"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">],</span>
            <span class="s2">"columns"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"城市"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"cityName"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"实际GMV"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"gmv"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"GMV目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"gmvGoal"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"GMV月目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"gmvMonthGoalShow"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"GMV完成率"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'gmvPercent'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"实际毛利额"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'profit'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"毛利额目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'profitGoal'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"毛利额月目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'profitMonthGoalShow'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"毛利额完成率"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'profitPercent'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"实际净利润"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'netProfit'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"净利润目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'netProfitGoal'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"净利润月目标"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'netProfitMonthGoalShow'</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"sTitle"</span><span class="p">:</span> <span class="s2">"净利润完成率"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="s1">'netProfitPercent'</span><span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">"aoColumnDefs"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">'aTargets'</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">'mRender'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="p">(</span><span class="nx">data</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"%"</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">"footerCallback"</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">display</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">(),</span> <span class="nx">data</span><span class="p">;</span>
                <span class="c1">// Remove the formatting to get integer data for summation</span>
                <span class="kd">var</span> <span class="nx">intVal</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">i</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">i</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="p">?</span>
                        <span class="nx">i</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[\$</span><span class="sr">,</span><span class="se">]</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span> <span class="p">:</span>
                        <span class="k">typeof</span> <span class="nx">i</span> <span class="o">===</span> <span class="s1">'number'</span> <span class="p">?</span>
                            <span class="nx">i</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">};</span>
                <span class="kd">var</span> <span class="nx">goalToal</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="kd">var</span> <span class="nx">actual</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="kd">var</span>  <span class="nx">i</span> <span class="o">=</span><span class="mi">1</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;=</span><span class="mi">12</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                    <span class="c1">//实际总计</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">===</span><span class="mi">1</span><span class="o">||</span><span class="nx">i</span><span class="o">===</span><span class="mi">5</span><span class="o">||</span><span class="nx">i</span><span class="o">===</span><span class="mi">9</span><span class="p">){</span>
                        <span class="nx">pageTotal</span> <span class="o">=</span> <span class="nx">api</span>
                            <span class="p">.</span><span class="nx">column</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="p">{</span> <span class="na">page</span><span class="p">:</span> <span class="s1">'current'</span><span class="p">}</span> <span class="p">)</span>
                            <span class="p">.</span><span class="nx">data</span><span class="p">()</span>
                            <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">a</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="nx">b</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="k">return</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">+</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
                            <span class="p">},</span> <span class="mi">0</span> <span class="p">);</span>
                        <span class="nx">actual</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pageTotal</span><span class="p">;</span>
                        <span class="nx">$</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">column</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">footer</span><span class="p">()).</span><span class="nx">html</span><span class="p">(</span>
                            <span class="nx">pageTotal</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">2</span><span class="o">||</span><span class="nx">i</span><span class="o">===</span><span class="mi">6</span><span class="o">||</span><span class="nx">i</span><span class="o">===</span><span class="mi">10</span><span class="p">){</span>
                        <span class="nx">pageTotal</span> <span class="o">=</span> <span class="nx">api</span>
                            <span class="p">.</span><span class="nx">column</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="p">{</span> <span class="na">page</span><span class="p">:</span> <span class="s1">'current'</span><span class="p">}</span> <span class="p">)</span>
                            <span class="p">.</span><span class="nx">data</span><span class="p">()</span>
                            <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">a</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="nx">b</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="k">return</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">+</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
                            <span class="p">},</span> <span class="mi">0</span> <span class="p">);</span>
                        <span class="nx">goalToal</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pageTotal</span><span class="p">;</span>
                        <span class="nx">$</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">column</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">footer</span><span class="p">()).</span><span class="nx">html</span><span class="p">(</span>
                            <span class="nx">pageTotal</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span><span class="mi">4</span> <span class="o">||</span><span class="nx">i</span> <span class="o">===</span><span class="mi">8</span><span class="o">||</span><span class="nx">i</span><span class="o">===</span> <span class="mi">12</span><span class="p">){</span>
                        <span class="nx">$</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">column</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">footer</span><span class="p">()).</span><span class="nx">html</span><span class="p">(</span>
                            <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="nx">actual</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="nx">goalToal</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">goalToal</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">2</span><span class="p">])))).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span>
                            <span class="o">+</span><span class="s1">'%'</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="c1">// Total over this page</span>
                        <span class="nx">pageTotal</span> <span class="o">=</span> <span class="nx">api</span>
                            <span class="p">.</span><span class="nx">column</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="p">{</span> <span class="na">page</span><span class="p">:</span> <span class="s1">'current'</span><span class="p">}</span> <span class="p">)</span>
                            <span class="p">.</span><span class="nx">data</span><span class="p">()</span>
                            <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">a</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="nx">b</span><span class="o">=</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
                                <span class="k">return</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">+</span> <span class="nx">intVal</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
                            <span class="p">},</span> <span class="mi">0</span> <span class="p">);</span>
                        <span class="c1">// Update footer</span>
                        <span class="nx">$</span><span class="p">(</span> <span class="nx">api</span><span class="p">.</span><span class="nx">column</span><span class="p">(</span> <span class="nx">i</span> <span class="p">).</span><span class="nx">footer</span><span class="p">()</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span>
                            <span class="nx">pageTotal</span>
                            <span class="c1">//+' ( '+ total +' total)'</span>
                        <span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="复杂表头需求">复杂表头需求</h4>

<p><img src="/img/fzbt.jpg" alt="查询执行路径图" />
其实就是在表头改动一下就行了：<br /></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre> <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"buyAndSaleTable"</span> <span class="na">class=</span><span class="s">"table table-striped table-bordered table-hover"</span> <span class="na">cellspacing=</span><span class="s">"0"</span>
                       <span class="na">width=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!--table table-striped table-bordered table-hover--&gt;</span>
                    <span class="c">&lt;!--table-condensed font-small table-hover table-striped dataTable no-footer--&gt;</span>
                    <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="c">&lt;!--rowspan纵向合并 colspan横向合并--&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">rowspan=</span><span class="s">"2"</span> <span class="na">style=</span><span class="s">"text-align: center"</span><span class="nt">&gt;</span>城市<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">rowspan=</span><span class="s">"2"</span> <span class="na">style=</span><span class="s">"text-align: center"</span><span class="nt">&gt;</span>品类<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"6"</span> <span class="na">style=</span><span class="s">"text-align: center"</span><span class="nt">&gt;</span>GMV统计<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"6"</span> <span class="na">style=</span><span class="s">"text-align: center"</span><span class="nt">&gt;</span>毛利额统计<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;th&gt;</span>当期GMV<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>周期环比GMV<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>月环比GMV<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>月环比增长率<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>同比GMV<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>同比增长率<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>当期毛利额<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>周期环比毛利额<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>月环比毛利额<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>月环比增长率<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>同比毛利额<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span>同比增长率<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;/thead&gt;</span>
                    <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"buyAndSale"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/tbody&gt;</span>
                <span class="nt">&lt;/table&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="小结">小结</h2>
<p>  说说自己的使用的疑惑，一开始使用觉得初始化的东西太多了，记都记不住。但是希望你明白一个道理，先使用它做个demo看看。
国际化操作那一块，我个人是没有记的，每次都是直接copy过来使用。其他地方熟能生巧。相信会很快上手。</p>

                
                
                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2018/10/26/algorithm/" data-toggle="tooltip" data-placement="top" title="常用算法实现">
                        Previous<br>
                        <span>常用算法实现</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/10/30/showData-Echarts/" data-toggle="tooltip" data-placement="top" title="数据可视化--Echarts">
                        Next<br>
                        <span>数据可视化--Echarts</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0013" 
                    href="/archive/?tag=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"
                    title="数据可视化"
                    rel="3">数据可视化
    </div>
</section>


                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: ''
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>




    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/WantUzZ">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>
                <p class="copyright text-muted">
                  <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span> | <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> | <span id="busuanzi_container_page_pv">本文总阅读<span id="busuanzi_value_page_pv"></span>次</span>
                   <!-- <a href="http://gfwant.com">want</a> | -->
                  <iframe
                      style="margin-left: 2px; margin-bottom:-5px;"
                      frameborder="0" scrolling="0" width="100px" height="20px"
                      src="" >
                  </iframe>
                </p>
                <p class="copyright text-muted">
                    Copyright &copy; want 2019
                     <!-- <a href="http://gfwant.com">want</a> | -->
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>
<!-- https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true -->
<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-49627206-1';
    var _gaDomain = 'gfwant.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->



  <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    //新增访问次数
    function addCount(Counter) {
      // 页面（博客文章）中的信息：leancloud_visitors
      // id为page.url， data-flag-title为page.title
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("visited_times");// 将点击次数加1
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                var newTimes = counter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            // 执行这里，说明LeanCloud中还没有记录此文章
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("post_title", title);// 把文章标题
            newcounter.set("post_url", url); // 文章url
            newcounter.set("visited_times", 1); // 初始点击次数：1次
            newcounter.save(null, { // 上传到LeanCloud服务器中
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                var newTimes = newcounter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //仅根据url和title查出当前访问次数，不做+1操作
    function showCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            var $element = $(document.getElementById(url));
            var newTimes = counter.get('visited_times');
            $element.find('.leancloud-visitors-count').text(newTimes);
          } else {
            //如果表里没查到记录，那就是异常情况了
            console.log('异常情况，不应该没记录的');
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //调用API获取IP
    function getVisitorIpAndJudge() {
      var ip;
      var options = {
        type: 'POST',
        dataType: "json",
        //async: false, //jquery3中可以直接使用回调函数，不用再指定async
        url: "https://freegeoip.net/json/?callback=?"
      };
      $.ajax(options)
      .done(function(data, textStatus, jqXHR) {
        if(textStatus == "success") {
          ip = data.ip;
        }
        judgeVisitor(ip)
      });
    }

    //判断访客是否已访问过该文章，及访问时间，符合条件则增加一次访问次数
    function judgeVisitor(ip) {
      var Counter = AV.Object.extend("visited_times");
      var Visitor = AV.Object.extend("visitors_record");

      var $postInfo = $(".leancloud_visitors");
      var post_url = $postInfo.attr('id').trim();

      var query = new AV.Query(Visitor);

      query.equalTo("visitor_ip", ip);
      query.equalTo("post_url", post_url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            console.log('该IP已访问过该文章');

            var oldVisitor = results[0];

            var lastTime = oldVisitor.updatedAt;
            var curTime = new Date();

            var timePassed = curTime.getTime() - lastTime.getTime();

            if(timePassed > 1 * 60 * 1000) {
              console.log('距离该IP上一次访问该文章已超过了1分钟，更新访问记录，并增加访问次数');

              addCount(Counter);

              oldVisitor.fetchWhenSave(true);
              oldVisitor.save(null, {
                success: function(oldVisitor) { },
                error: function(oldVisitor, error) {
                  console.log('Failed to save visitor record, with error message: ' + error.message);
                }
              });
            } else {
              console.log('这是该IP 1分钟内重复访问该文章，不更新访问记录，不增加访问次数');
              showCount(Counter);
            }
          } else {
            console.log('该IP第一次访问该文章，保存新的访问记录，并增加访问次数');

            addCount(Counter);

            var newVisitor = new Visitor();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newVisitor.setACL(acl);
            newVisitor.set("visitor_ip", ip);
            newVisitor.set("post_url", post_url);
            newVisitor.save(null, { // 上传到LeanCloud服务器中
              success: function(newVisitor) { },
              error: function(newVisitor, error) {
                console.log('Failed to create visitor record, with error message: ' + error.message);
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
          addCount(Counter);
        }
      });
    }

    $(function() {
      if ($('.leancloud_visitors').length == 1) {
        // 文章页面，调用判断方法，对符合条件的访问增加访问次数
        getVisitorIpAndJudge();
      } else if ($('.post-link').length > 1){
        // 首页 暂未使用
        // showHitCount(Counter);
      }
    });
  </script>


<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
