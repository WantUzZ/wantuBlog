<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>want</title>
    <description>关于程序与设计、黑客与画家 | 王涛，Web &amp; Mobile Lover，Software Engineer，UX Designer | 这里是 @want王涛 的个人博客，与你一起发现更大的世界。</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 05 Dec 2023 17:49:09 +0800</pubDate>
    <lastBuildDate>Tue, 05 Dec 2023 17:49:09 +0800</lastBuildDate>
    <generator>Jekyll v4.3.2</generator>
    
      <item>
        <title>CI/CD</title>
        <description>&lt;h1 id=&quot;介绍&quot;&gt;介绍&lt;/h1&gt;

&lt;p&gt;CICD 代表持续集成（Continuous Integration）和持续交付（Continuous Delivery），是一种软件开发实践，旨在通过自动化软件构建、测试和部署的过程，实现对软件的快速、可靠的交付。&lt;/p&gt;

&lt;p&gt;CICD 工具集包括各种自动化构建工具、测试工具、部署工具，以及用于监视和日志记录的工具。流行的 CICD 工具包括 Jenkins、Travis CI、GitLab CI/CD、CircleCI 等。&lt;/p&gt;

&lt;h1 id=&quot;gitlab-cicd&quot;&gt;GitLab CI/CD&lt;/h1&gt;

&lt;h2 id=&quot;前置条件&quot;&gt;前置条件&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;可用的 Runner&lt;/li&gt;
  &lt;li&gt;项目权限&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;gitlab-runner&quot;&gt;GitLab Runner&lt;/h2&gt;

&lt;p&gt;本质来说，Runner 就是一个可以提供执行脚本环境的环境。它会根据.gitlab-ci.yml 配置文件来执行一连串的任务。Runner 可以被灵活的安装在服务器、Docker 上。&lt;/p&gt;

&lt;h2 id=&quot;开始&quot;&gt;开始&lt;/h2&gt;

&lt;p&gt;在安装配置好 Runner 后，创建.gitlab-ci.yml 文件，可用在其中配置 GitLab CI/CD 的特定指令。
文件中定义:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Runner 应执行的作业的结构和顺序&lt;/li&gt;
  &lt;li&gt;Runner 在遇到特定条件时做出的决定&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;基本流程&quot;&gt;基本流程&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;研发推送代码&lt;/li&gt;
  &lt;li&gt;触发 GitLab CI&lt;/li&gt;
  &lt;li&gt;runner 执行预定义的脚本&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;概念&quot;&gt;概念&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;流水线（Pipelines）。顶级组件。
流水线包括：
工作（Jobs）。定义做什么。例如，编译或测试代码的作业。
阶段 (Stages)。定义何时运行作业。例如，在编译代码的阶段之后运行测试的阶段。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;作业(Job)。流水线配置从作业开始。作业是.gitlab-ci.yml 文件中最基本的元素。
工作是：定义了约束条件，说明它们应该在什么条件下执行。
具有任意名称的顶级元素，并且必须至少包含 script 子句。
不限制可以定义的数量
&lt;img src=&quot;/img/20231122_cicdno1.jepg&quot; alt=&quot;Alt text&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;环境变量（Variables）。变量通过使其他地方定义的值可供作业访问来帮助您自定义作业。它们可以硬编码在.gitlab-ci.yml 文件、项目设置中，也可以动态生成。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;实践&quot;&gt;实践&lt;/h2&gt;

&lt;p&gt;理想的 CI/CD 流程：从功能分支和合并请求开始工作，并且仅在更改合并到默认分支时才触发 CI/CD，并且流水线的 styleCheck、test、build、deploy 等任务是顺序执行的。&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;# 全局变量&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;variables&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;XXX&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;xxx&quot;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# 定义4个stage&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;stages&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;styleCheck&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;test&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;build&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;deploy&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;style-check-job&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;styleCheck&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 此job匹配哪个branch或者tag或者trigger&lt;/span&gt;
   &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dev&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#- &amp;lt;一个匹配日常分支的正则&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
   &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 此job忽略tag&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# 每一个 job，需要定义一个 image&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;xxx镜像地址xxx&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;npm i&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;npm run eslint&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;${CI_COMMIT_REF_SLUG}&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;node_modules/&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;test-job&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# 注明该任务在test阶段执行&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;	script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  	&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;npm install --registry=https://registry.npmmirror.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;- npm run test&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;build-job&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# 注明该任务在build阶段执行&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;build&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;	script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  	&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;npm run build&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;deploy-job&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# 注明该任务在deploy阶段执行&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;deploy&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;	script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  	&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;npm deploy&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Sun, 10 Sep 2023 18:00:00 +0800</pubDate>
        <link>http://localhost:4000/2023/09/10/CICD/</link>
        <guid isPermaLink="true">http://localhost:4000/2023/09/10/CICD/</guid>
        
        <category>CI</category>
        
        <category>CD</category>
        
        <category>Git Lab</category>
        
        
      </item>
    
      <item>
        <title>回顾这一年，2021。</title>
        <description>&lt;h2 id=&quot;去年&quot;&gt;去年&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;换了一份工作&lt;/li&gt;
  &lt;li&gt;去了重庆、成都、黄山、千岛湖&lt;/li&gt;
  &lt;li&gt;读了几本书&lt;/li&gt;
  &lt;li&gt;锻炼了 100 次&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;感悟&quot;&gt;感悟&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;世界上完满的东西都是极其稀少的，聪明的头脑、和谐美满的家庭、靠谱的朋友、体贴的爱人、美丽的容颜和健硕得体的身体，想都要，是不是有些贪心～&lt;/li&gt;
  &lt;li&gt;回过头看，确确实实是那些沉重又窒息的时刻不断淬炼你的身心，让你更加强大。&lt;/li&gt;
  &lt;li&gt;一个人的人格和脾性或如树木。汲取身边的土壤的养分或是毒害。庆幸的是人是有选择的权利的。&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Tue, 10 May 2022 04:00:00 +0800</pubDate>
        <link>http://localhost:4000/2022/05/10/yearSummary/</link>
        <guid isPermaLink="true">http://localhost:4000/2022/05/10/yearSummary/</guid>
        
        <category>年度总结</category>
        
        
      </item>
    
      <item>
        <title>食记</title>
        <description>&lt;h2 id=&quot;中国菜的特点&quot;&gt;中国菜的特点&lt;/h2&gt;

&lt;h4 id=&quot;传统中国菜&quot;&gt;传统中国菜&lt;/h4&gt;

&lt;p&gt;传统的中国菜分为 8 大菜系，分别是：川、鲁、湘、粤、徽、闽、浙、苏。&lt;br /&gt;
川、湘菜以辣见长，口味较重。口味区别在于川菜多麻辣，但是湘菜多香辣。&lt;br /&gt;
徽菜口味鲜辣，重油、重色、重火功。口味适中，不如江浙菜的清淡、也不如川湘菜的浓重。&lt;br /&gt;
苏（江苏）菜、浙（浙江）菜个人喜欢统称之为江浙菜，两者口味相近，都是十分清淡的，菜式精致、小巧。&lt;br /&gt;
鲁菜，口味咸鲜为主，火候精湛，善制汤。&lt;br /&gt;
闽菜，口味鲜香为主，尤以“香”、“味”见长，其清鲜、和醇、荤香、不腻的风格。&lt;br /&gt;
粤菜，口味鲜香为主，讲究菜的气势，档次。&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;非传统中国菜&quot;&gt;非传统中国菜&lt;/h4&gt;

&lt;p&gt;…&lt;/p&gt;

&lt;h2 id=&quot;调料&quot;&gt;调料&lt;/h2&gt;

&lt;h4 id=&quot;基础调料&quot;&gt;基础调料&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;盐。咸味，百味之首，构成食物的底味，或者说引出食物的底味。&lt;/li&gt;
  &lt;li&gt;味精。鲜味，提升菜品的鲜度，常与盐一起使用，出锅前用少量使用，不要夺取食物自身的鲜味。&lt;/li&gt;
  &lt;li&gt;白糖。甜味，白糖提鲜，也可以缓冲过量的某一味道（咸味）。&lt;/li&gt;
  &lt;li&gt;陈醋。酸味，常用于面食物，增加食欲。&lt;/li&gt;
  &lt;li&gt;白醋。酸味、无色，可以增加食物的味道，煎蛋花加入适量可以使蛋更加嫩。&lt;/li&gt;
  &lt;li&gt;生抽。调味。&lt;/li&gt;
  &lt;li&gt;老抽。上色。&lt;/li&gt;
  &lt;li&gt;料酒。去腥。&lt;/li&gt;
  &lt;li&gt;鸡精。鲜味，需要较早放入菜品。&lt;/li&gt;
  &lt;li&gt;黑胡椒粉。辛辣味。&lt;/li&gt;
  &lt;li&gt;辣椒粉。辣味。&lt;/li&gt;
  &lt;li&gt;白胡椒粉。辛辣味。&lt;/li&gt;
  &lt;li&gt;蚝油。提鲜。需要放入冰箱冷冻保存。&lt;/li&gt;
  &lt;li&gt;豆瓣酱。咸、甜、辣，提鲜以及提升菜品的颜色。需要放入冰箱冷冻保存。&lt;/li&gt;
  &lt;li&gt;泡椒。酸辣味。需要放入冰箱冷冻保存。&lt;/li&gt;
  &lt;li&gt;蒸鱼豉油。鲜味。&lt;/li&gt;
  &lt;li&gt;香油。香味。&lt;/li&gt;
  &lt;li&gt;玉米淀粉。用于勾芡、炒制前食材的腌制。&lt;/li&gt;
  &lt;li&gt;冰糖。甜味，用于糖色的炒制。&lt;/li&gt;
  &lt;li&gt;花椒。麻味。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;火&quot;&gt;火&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;电磁炉。温度不高，个人觉得不适合用来做菜。&lt;/li&gt;
  &lt;li&gt;明火 - 家用，天然气或者其他。温度高且稳定。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;烹饪工具&quot;&gt;烹饪工具&lt;/h2&gt;

&lt;h4 id=&quot;厨具&quot;&gt;厨具&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;炒锅。按材质可以分为很多类。选一个自己喜欢的材质的即可。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;蒸锅。用于蒸煮食材。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;砂锅。用于炖煮食材，砂锅能够使外部温度均匀的传递给食材。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;雪平锅。常用于炸品、煮面、凉拌&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;…&lt;/p&gt;

    &lt;p&gt;个人的使用频率：炒锅　&amp;gt; 蒸锅 &amp;gt; 砂锅 &amp;gt; 雪平锅&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;刀具&quot;&gt;刀具&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;菜刀。功夫在高也怕菜刀 🔪。一把菜刀走天下。切、片、砍都能驾驭。&lt;/li&gt;
  &lt;li&gt;砍骨刀。菜刀再高，也怕骨头硬！备一把砍骨刀会增加菜刀的使用寿命，毕竟谁也不想经常磨刀。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;做菜整体流程&quot;&gt;做菜整体流程&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;食材的准备阶段。包括食材的清洗、切配、调味品的准备。&lt;/li&gt;
  &lt;li&gt;熟记菜谱并按照其上的顺序进行操作。&lt;/li&gt;
  &lt;li&gt;餐品出锅装盘、摆盘。&lt;/li&gt;
  &lt;li&gt;拍照。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;烹饪技法&quot;&gt;烹饪技法&lt;/h2&gt;

&lt;h4 id=&quot;人的要素&quot;&gt;人的要素&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;勇气。&lt;br /&gt;
1.1. 锅因为油温太高，起火了，不要怕。拿锅盖盖上就是。&lt;br /&gt;
1.2. 敢颠锅。油温高，加入食材之后的一小段时间，颠锅非常容易锅内起火，不要慌，继续颠。&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;细心。切菜的时候要全身灌注。特别对这些比较滑的食材。&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;坚持。唯手熟尔。&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;辅助工具&quot;&gt;辅助工具&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;手机定时器。一道菜要达到预期，对火候、制作时间、食材都有所要求。比如蒸煮时间，可以借助手机定时器来进行提醒，让最棒的成品出现在我们眼前。&lt;/li&gt;
  &lt;li&gt;菜谱软件。&lt;/li&gt;
  &lt;li&gt;竹筷子。用于油温的测量。&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;刀法&quot;&gt;刀法&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;握刀。参见美食作家王刚的握刀手法。值得注意的是，大拇指一定要缩进食指内。否则很容易切到手。
前面 30 秒内容。&lt;a href=&quot;https://www.xiachufang.com/recipe/103727348/&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;切工。切菜不要过于拘谨。放松。切菜的时候左手的大拇指一定要缩进其余四指里面，防止切到手。
&lt;img src=&quot;/img/cook/左手握法.jpg&quot; alt=&quot;左手握法&quot; /&gt;
在进行一些切丝的过程中切片之后可以将食材片按顺序。
&lt;img src=&quot;/img/cook/土豆丝堆叠.jpg&quot; alt=&quot;切丝&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;…&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;技法&quot;&gt;技法&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;炒。热锅热油，加入底油进行炒制。&lt;/li&gt;
  &lt;li&gt;烧。食材经过热处理之后，先用大火烧开，再用小火慢慢收汁。&lt;/li&gt;
  &lt;li&gt;炖。同烧类似，只不过，炖所保留的汤汁会多些，并且食材结果要求是软烂。&lt;/li&gt;
  &lt;li&gt;蒸。利用水蒸气将食材蒸熟。&lt;/li&gt;
  &lt;li&gt;煎。先下油，在下入食材进行两面煎煮。&lt;/li&gt;
  &lt;li&gt;炝。凉拌菜的制作方式，食材经过水烫或油滑，加上盐，味精，花椒油拌和的一种冷菜烹调方法。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;小技巧&quot;&gt;小技巧&lt;/h4&gt;

&lt;p&gt;有道无术，术尚可求也。有术无道，止于术也。&lt;/p&gt;

&lt;h6 id=&quot;炒菜&quot;&gt;炒菜&lt;/h6&gt;

&lt;ol&gt;
  &lt;li&gt;热锅冷油适用大部分的炒菜。&lt;/li&gt;
  &lt;li&gt;炒制常见青菜，蒜切片，爆香，成菜味型更对。&lt;/li&gt;
  &lt;li&gt;煎蛋花的时候加入少许白醋，蛋花会更嫩。&lt;/li&gt;
  &lt;li&gt;用好一些有特殊香味的食材（芹菜），会使成菜在味觉上更加惊艳。&lt;/li&gt;
  &lt;li&gt;青椒炒蛋，建议加入豆豉味道会上一个台阶。&lt;/li&gt;
  &lt;li&gt;牛肉与香菜、芹菜的组合。&lt;/li&gt;
  &lt;li&gt;制作肉菜时，蒜是必要的，但是量得自己把控…&lt;/li&gt;
  &lt;li&gt;猪油在炒制青菜是会比其他油脂更香。&lt;/li&gt;
  &lt;li&gt;调味品的加入时间大部分是在食材快出锅之前加入。&lt;/li&gt;
  &lt;li&gt;土豆这味食材，要针对菜品对其本身的淀粉进行取舍。比如说，做酸辣土豆丝的时候切完之后要用清水清洗土豆丝多次到水质澄澈，到了就说明淀粉洗没了，这样做出的土豆丝才不会黏糊。当然在制作一些炖菜的时候我们需要汤汁尽量的浓郁，这个时候土豆就不需要清洗了。&lt;/li&gt;
  &lt;li&gt;食材本身如果过于坚硬难熟，可以提前焯水让其先熟，保证菜品在出锅时，各种食材都应是熟的状态，并且其品相都很棒。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h6 id=&quot;炖菜&quot;&gt;炖菜&lt;/h6&gt;

&lt;ol&gt;
  &lt;li&gt;为保证餐品出餐前的品相，留意配菜加入的时间节点。比如说，黄焖鸡这道菜，青椒加入的时间不应过早加入，不然在砂锅的高温下，其颜色就无法留存。&lt;/li&gt;
  &lt;li&gt;增香型配菜尽量早加，比如已经泡发好的干香菇，在炖煮过程中应该同食物一起今早放入炖煮。&lt;/li&gt;
&lt;/ol&gt;

&lt;h6 id=&quot;蒸菜&quot;&gt;蒸菜&lt;/h6&gt;

&lt;ol&gt;
  &lt;li&gt;水蒸蛋配比–蛋水比 1:1.5。为半个蛋壳作为容器可以轻松进行衡量水的量。&lt;/li&gt;
  &lt;li&gt;蒸鱼豉油在制作一些蒸菜时加入的时间是在淋完热油之后加入。&lt;/li&gt;
  &lt;li&gt;蒸米粉肉时，裹上米粉的肉放入蒸锅，蒸锅中应事先垫一些青菜或者土豆片。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;菜谱来源&quot;&gt;菜谱来源&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;菜谱软件，比如下厨房。&lt;/li&gt;
  &lt;li&gt;哔哩哔哩美食区。如知名 up 主王刚。&lt;/li&gt;
  &lt;li&gt;抖音美食博主。&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;成品展示&quot;&gt;成品展示&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/img/cook/白灼虾.jpeg&quot; alt=&quot;白灼虾-清炒时蔬&quot; /&gt;
&lt;img src=&quot;/img/cook/红烧肉.jpeg&quot; alt=&quot;红烧肉-鲫鱼豆腐汤&quot; /&gt;
&lt;img src=&quot;/img/cook/鸡爪煲.jpeg&quot; alt=&quot;鸡爪煲-青椒炒蛋&quot; /&gt;
&lt;img src=&quot;/img/cook/口水鸡.jpeg&quot; alt=&quot;口水鸡&quot; /&gt;
&lt;img src=&quot;/img/cook/苦瓜虾.jpeg&quot; alt=&quot;清炒苦瓜-油爆虾&quot; /&gt;
&lt;img src=&quot;/img/cook/香辣小龙虾.jpeg&quot; alt=&quot;香辣小龙虾&quot; /&gt;
&lt;img src=&quot;/img/cook/地三鲜.jpeg&quot; alt=&quot;地三鲜&quot; /&gt;
&lt;img src=&quot;/img/cook/红烧排骨.jpeg&quot; alt=&quot;红烧排骨&quot; /&gt;
&lt;img src=&quot;/img/cook/香菇炖排骨.jpeg&quot; alt=&quot;香菇炖排骨&quot; /&gt;
&lt;img src=&quot;/img/cook/芹菜炒肉.jpeg&quot; alt=&quot;芹菜炒肉&quot; /&gt;
&lt;img src=&quot;/img/cook/清炒时蔬.jpeg&quot; alt=&quot;清炒白菜&quot; /&gt;
&lt;img src=&quot;/img/cook/清蒸鳜鱼.jpeg&quot; alt=&quot;清蒸鳜鱼&quot; /&gt;
&lt;img src=&quot;/img/cook/蒜蓉粉丝虾.jpeg&quot; alt=&quot;蒜蓉粉丝虾&quot; /&gt;
&lt;img src=&quot;/img/cook/腊味.jpg&quot; alt=&quot;腊味&quot; /&gt;
&lt;img src=&quot;/img/cook/小炒黄牛肉.jpg&quot; alt=&quot;小炒黄牛肉&quot; /&gt;
&lt;img src=&quot;/img/cook/土豆烧牛腩.jpg&quot; alt=&quot;土豆烧牛腩&quot; /&gt;
&lt;img src=&quot;/img/cook/合拍一.jpeg&quot; alt=&quot;合拍一&quot; /&gt;
&lt;img src=&quot;/img/cook/合拍二.jpeg&quot; alt=&quot;合拍二&quot; /&gt;
&lt;img src=&quot;/img/cook/合拍四.jpeg&quot; alt=&quot;合拍四&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 28 Nov 2021 18:00:00 +0800</pubDate>
        <link>http://localhost:4000/2021/11/28/cook/</link>
        <guid isPermaLink="true">http://localhost:4000/2021/11/28/cook/</guid>
        
        <category>美食</category>
        
        
      </item>
    
      <item>
        <title>写代码的一些整理</title>
        <description>&lt;p&gt;编码是每个程序员每天都在做的事情。写好代码是很重要的！&lt;/p&gt;

&lt;h2 id=&quot;写好代码不是那么容易的&quot;&gt;写好代码不是那么容易的&lt;/h2&gt;

&lt;h4 id=&quot;0-40&quot;&gt;0-&amp;gt;40&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;代码是由字母组成。所以请确保单词拼写正确。可以借助辅助的单词检查插件进行检查。&lt;/li&gt;
  &lt;li&gt;命名最好简单明了，谷歌翻译是个好东西。&lt;/li&gt;
  &lt;li&gt;变量命令请用名词，如果不清楚其可数、不可数名次的拼写形式，建议后面加上集合的名称。例如 nameList、nameArr。动作函数请用动词。&lt;/li&gt;
  &lt;li&gt;减少变量。尽可能的少用局部变量、哨兵变量。&lt;/li&gt;
  &lt;li&gt;函数的形参列表，参数超过 2 个，最好将形参变成对象。&lt;/li&gt;
  &lt;li&gt;多尝试封装。即使不能复用，也便于阅读。&lt;/li&gt;
  &lt;li&gt;函数尽可能的简单。理解起来简单，做一个简单功能，行数精简，腾讯代码规范中一个函数的代码行数不要超过 80 行。&lt;/li&gt;
  &lt;li&gt;代码分成段落。类比写文章，每个段落想说的东西是不一样的。&lt;/li&gt;
  &lt;li&gt;扎实的语言语法。&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;40-60&quot;&gt;40-&amp;gt;60&lt;/h4&gt;

&lt;p&gt;写代码的套路:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;请求参数校验。&lt;/li&gt;
  &lt;li&gt;空、错误处理。&lt;/li&gt;
  &lt;li&gt;业务（层层调用）。&lt;/li&gt;
  &lt;li&gt;数据整理并返回。&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;60-70&quot;&gt;60-&amp;gt;70&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;避免请求参数暴露数据库信息，比如一些状态的枚举值。&lt;/li&gt;
  &lt;li&gt;避免因为主键而导致的数据量的泄漏。&lt;/li&gt;
  &lt;li&gt;避免数据结构暴露数据库表结构。&lt;/li&gt;
  &lt;li&gt;使用德摩根定理。( !a &amp;amp;&amp;amp; !b) === !( a || b ) 。&lt;/li&gt;
  &lt;li&gt;必要的注释，在复杂的业务功能的接口上写上完整的操作步骤。&lt;/li&gt;
  &lt;li&gt;尽可能的避免 if 嵌套。可以采用提前 return。&lt;/li&gt;
  &lt;li&gt;熟练使用一些成熟的模块的方法，比如 lodash 等。&lt;/li&gt;
  &lt;li&gt;报错应该统一，并且错误级别应该明确。&lt;/li&gt;
  &lt;li&gt;联调之前一定要自测。&lt;/li&gt;
  &lt;li&gt;善用弱类型语言中一些语法。比如说：解构、展开、继承。&lt;/li&gt;
  &lt;li&gt;尝试用管道操作（filter、map）去替换 for 循环。代码会更加清晰。&lt;/li&gt;
  &lt;li&gt;复杂的条件逻辑可以封装成一个带有说明的函数。这样在阅读时见文知意，一目了然。&lt;/li&gt;
  &lt;li&gt;分离查询函数与修改函数。查询函数只是提供一个值，函数没有任何的副作用，可随意操作。修改函数显然就要慎重对待了。明确分离“有副作用”和“无副作用”两种函数是一个很好的想法。&lt;/li&gt;
  &lt;li&gt;以【卫语句】取代嵌套条件表达式。卫语句的精髓就是给予某条分支特别的重视，它告诉阅读者，这种情况并不是本函数的所关心的核心逻辑，如果它真的发生了，会做一些必要的工作然后提前退出。&lt;/li&gt;
  &lt;li&gt;面向对象编程。&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;70&quot;&gt;70&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;编写单元测试。&lt;/li&gt;
  &lt;li&gt;同业务方、产品进行及时的沟通，一旦需求不明确就要确认，将已经确认的信息进行记录。&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Sat, 17 Jul 2021 18:12:00 +0800</pubDate>
        <link>http://localhost:4000/2021/07/17/codeStyle/</link>
        <guid isPermaLink="true">http://localhost:4000/2021/07/17/codeStyle/</guid>
        
        <category>code</category>
        
        
      </item>
    
      <item>
        <title>中国近代史</title>
        <description>&lt;h1 id=&quot;问题&quot;&gt;问题&lt;/h1&gt;

&lt;p&gt;Q: 中国为何会遭受这几百年屈辱的历史，造成近代中国的苦难的原因是什么？&lt;br /&gt;
Q: 中国国内的精英都做了些什么？&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;近代史&quot;&gt;近代史&lt;/h1&gt;

&lt;h2 id=&quot;第一次鸦片战争&quot;&gt;第一次鸦片战争&lt;/h2&gt;

&lt;h2 id=&quot;第二次鸦片战争&quot;&gt;第二次鸦片战争&lt;/h2&gt;

&lt;h2 id=&quot;洋务运动&quot;&gt;洋务运动&lt;/h2&gt;

&lt;h2 id=&quot;太平天国运动&quot;&gt;太平天国运动&lt;/h2&gt;

&lt;h2 id=&quot;义和团&quot;&gt;义和团&lt;/h2&gt;

&lt;h2 id=&quot;五四爱国运动&quot;&gt;五四爱国运动&lt;/h2&gt;

&lt;h2 id=&quot;中华民国&quot;&gt;中华民国&lt;/h2&gt;

&lt;h2 id=&quot;新中国&quot;&gt;新中国&lt;/h2&gt;
</description>
        <pubDate>Sat, 17 Jul 2021 18:12:00 +0800</pubDate>
        <link>http://localhost:4000/2021/07/17/chinaHistory/</link>
        <guid isPermaLink="true">http://localhost:4000/2021/07/17/chinaHistory/</guid>
        
        <category>历史</category>
        
        <category>中国</category>
        
        <category>近代史</category>
        
        
      </item>
    
      <item>
        <title>环境搭建</title>
        <description>&lt;p&gt;2021年年初接到一个搭建新测试环境的活。&lt;/p&gt;

&lt;h2 id=&quot;要求&quot;&gt;要求&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;服务器OS得为CentOS&lt;/li&gt;
  &lt;li&gt;大部分的中间件跑到Docker&lt;/li&gt;
  &lt;li&gt;原先数据迁移到新的测试服务器&lt;/li&gt;
  &lt;li&gt;拉起原先的服务&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;具体实施&quot;&gt;具体实施&lt;/h2&gt;

&lt;h3 id=&quot;安装centos&quot;&gt;安装CentOS&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;下载软件用以制作启动盘
 1.1 下载UltralIso 用来制作启动盘。 教程 - https://jingyan.baidu.com/article/d621e8da4aae592865913f0e.html
 1.2 下载之后直接试用 下载地址：https://pan.baidu.com/s/1vi9__14DsWH-F0KfaC2bdw#list/path=%2F（已保存到本人的百度云盘/软件/软碟通）&lt;/li&gt;
  &lt;li&gt;制作启动盘
 2.1 选择X86版本。CentOSQL8 因为是做服务器所以minimal即可。（centos8.2没有找到镜像，我是直接到这个地方找的vault.centos.org）
 2.2【重要】 用管理员身份打开UltralIso，否则在写入硬盘映像的时候无法读取到U盘。
 2.3 接下来参考博文：https://blog.csdn.net/lianshaohua/article/details/88381039
 一定要注意下面标红色的部分！！！我在制作启动盘的时候将LABEL信息设置为CentOSQ-8，这个一定要记住。
  2.4 把LABEL的信息修改成小于11位的长度
  2.5 插入U盘
  2.6 点击顶部菜单中的&lt;strong&gt;启动&lt;/strong&gt; 选择 &lt;strong&gt;写入硬盘映像&lt;/strong&gt;
  2.7 硬盘驱动器选择你的U盘，写入方式usb+hdd+
  2.8 点击写入&lt;/li&gt;
  &lt;li&gt;安装
  3.1、把U盘插在电脑上（最好是后面的USB口，有些电脑的前置USB口不支持U盘启动）
  3.2、进入电脑的BIOS界面（网上百度，win10是按住shift关机 然后启动电脑的时候按住f2）
  3.3、BIOS设置启动 参考博文：https://blog.csdn.net/weixin_42625184/article/details/105219865
  本人安装的时候在制作启动盘的时候将LABEL设置为CentOSQL-8,进入安装选择界面的时候我们选择最上面的直接安装选项，按e键进行编辑，然后将光标移动到第三行，将相关内容进行删减，使其与LABEL对上。&lt;/li&gt;
  &lt;li&gt;手动分区：
 阿里云建议：https://developer.aliyun.com/article/539989
 总共1800G容量
   /boot 	500M
   /usr 	15G
   /var	5G
   /home	1600G
   / 	 	50G
   /tmp 	5G
   swap 	32G&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;【后采用】后面又进行了一次安装，认为不需要分太多的分区，只要/ /boot /boot/efi swap
  其中swap分区跟内存有关一般设置为内存的一半，但是如果服务器内存过大也可以少设置一点&lt;/p&gt;

&lt;p&gt;cat /proc/version  //查看系统版本和内核版本&lt;/p&gt;
&lt;h3 id=&quot;联网设置静态ip&quot;&gt;联网&amp;amp;设置静态IP&lt;/h3&gt;

&lt;p&gt;联网的话：&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;找一根网线（简单）&lt;/li&gt;
  &lt;li&gt;设置Wi-Fi&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;设置静态IP：
  CentOS中的网络配置：
   CentOS中网卡配置文件通常是在/etc/sysconfig/network-scripts/路径下，文件名称一般是“ifcfg-设备名称”形式，例如设备名称是eth0，那么文件名称就是“ifcfg-eth0”(0是数字“零”)。设备名称可以通过ifconfig命令查看。可以通过命令 vi /etc/sysconfig/network-scripts/ifcfg-eth0 编辑。
  具体:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;  TYPE=&quot;Ethernet&quot;
  BOOTPROTO=&quot;none&quot;
  DEFROUTE=&quot;yes&quot;
  IPV4_FAILURE_FATAL=&quot;no&quot;
  IPV6INIT=&quot;yes&quot;
  IPV6_AUTOCONF=&quot;yes&quot;
  IPV6_DEFROUTE=&quot;yes&quot;
  IPV6_FAILURE_FATAL=&quot;no&quot;
  IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;
  NAME=&quot;enp3s0&quot;
  UUID=&quot;xxxx-8f3a-42dc-90f6-3f80020d4f6b&quot;
  DEVICE=&quot;enp3s0&quot;
  ONBOOT=&quot;yes&quot;
  IPADDR=xxx.xx.xx.xx
  GATEWAY=xxx.xx.xx.1
  DNS1=8.8.8.8
  DNS2=114.114.114.114
  NETMASK=255.255.255.0
  PREFIX=24
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;配置完之后记得重启一下网络服务。&lt;/p&gt;

&lt;h3 id=&quot;数据迁移&quot;&gt;数据迁移&lt;/h3&gt;

&lt;p&gt;redis:通过主从复制完成。
&lt;strong&gt;相关命令&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;redis-cli -h 172.19.89.14 // 登陆某一台redis
slaveof 172.19.88.60 20001 // 将自己设置为某个Redis实例的从库

// 查看当前redis的 slave-read-only 配置
redis-cli -h 172.19.89.14 -p 6379 -a pwd123 config  get slave-read-only // 有密码
redis-cli -h 172.19.89.149 -p 6379 config get slave-read-only // 无密码

// 检查旧redis链接情况
redis-cli -h 172.19.88.60 -p 20001 client list  |awk -F'addr=' '{print$2}' | awk '{print$1}'|awk -F':' '{print$1}'|sort |uniq -c|sort -nr

// 查看当前Redis实例的角色，判断连接是否断开
redis-cli -h 172.19.89.149 -p 6379 info |grep role
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;mongodb: mongodump&amp;amp;mongorestore&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;将所有数据库导出到指定目录
mongodump -h 172.19.88.50 -o /home/want/mongodb&lt;/li&gt;
  &lt;li&gt;mongorestore还原数据库
mongorestore -r -h 172.19.89.149 –drop /home/want/mongodb
mongoresotre 支持-h可选项，所以不需要用scp将相关文件传输到对应的服务器上。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;mysql: mysqldump (将全部的数据库导成为一个sql文件)&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;mysqldump -h 172.19.88.50 -u root -p –all-databases &amp;gt; /usr/local/sqlfile.sql // 本地文件路径随意&lt;/li&gt;
  &lt;li&gt;登陆到指定MySQL实例上
mysql -h xxx.xx.xxx.xx -u -username -p&lt;/li&gt;
  &lt;li&gt;将sql文件恢复到指定MySQL数据库实例中
source /usr/local/sqlfile.sql&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;docker下载以及相关容器的部署&quot;&gt;Docker下载以及相关容器的部署&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;安装Docker。略～&lt;/li&gt;
  &lt;li&gt;安装docker-compose。略～&lt;/li&gt;
  &lt;li&gt;启动容器。通过docker-compose进行启动(创建网络，docker-compose.yml书写等，具体略～)&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;安装nginx配置nginx&quot;&gt;安装Nginx&amp;amp;配置Nginx&lt;/h3&gt;
&lt;p&gt;安装Nginx
1.sudo yum install nginx&lt;/p&gt;

&lt;p&gt;启用Nginx
sudo systemctl enable nginx 
sudo systemctl start nginx&lt;/p&gt;

&lt;p&gt;验证服务是否运行
sudo systemctl status nginx&lt;/p&gt;

&lt;p&gt;调整防火墙
sudo firewall-cmd –permanent –zone=public –add-service=http
sudo firewall-cmd –permanent –zone=public –add-service=https
sudo firewall-cmd –reload&lt;/p&gt;

&lt;p&gt;测试能否正常访问
在另一台电脑的地址栏中输入：http://xxx.xx.xx.xx&lt;/p&gt;

&lt;p&gt;Nginx配置:
~&lt;/p&gt;
&lt;h2 id=&quot;后记&quot;&gt;后记&lt;/h2&gt;
&lt;h3 id=&quot;参考&quot;&gt;参考&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;https://www.jianshu.com/p/52e3a005fc42&lt;/li&gt;
  &lt;li&gt;mongo: https://www.jianshu.com/p/667fd4fd6ff7&lt;/li&gt;
  &lt;li&gt;redis: https://juejin.cn/post/6844904127093440520&lt;/li&gt;
  &lt;li&gt;mysql: https://blog.csdn.net/zhangzhongzhong/article/details/54949191&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Thu, 03 Dec 2020 20:12:00 +0800</pubDate>
        <link>http://localhost:4000/2020/12/03/buildServer/</link>
        <guid isPermaLink="true">http://localhost:4000/2020/12/03/buildServer/</guid>
        
        <category>Linux</category>
        
        <category>Docker</category>
        
        <category>pm2</category>
        
        
      </item>
    
      <item>
        <title>TCP/IP相关知识</title>
        <description>&lt;h3 id=&quot;开始&quot;&gt;开始&lt;/h3&gt;

&lt;h4 id=&quot;我们在地址栏中输入wwwbaiducom发生了什么&quot;&gt;我们在地址栏中输入www.baidu.com发生了什么？&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/img/地址栏输入演示图.png&quot; alt=&quot;地址栏输入演示图&quot; /&gt;&lt;/p&gt;

&lt;p&gt;流程：&lt;br /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;域名解析&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;发起TCP3次握手&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;建立TCP连接后发起http请求&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;服务器响应请求，返回结果&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;浏览器获取到响应，构建DOM&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;网络&quot;&gt;网络&lt;/h4&gt;

&lt;p&gt;它在哪？&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/何为网络.png&quot; alt=&quot;何为网络&quot; /&gt;&lt;/p&gt;

&lt;p&gt;它理想的样子：&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/OSI7层模型.png&quot; alt=&quot;OSI7层模型&quot; /&gt;&lt;/p&gt;

&lt;p&gt;每一层的作用：&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/OSI7层模型的作用.png&quot; alt=&quot;OSI7层模型的作用&quot; /&gt;&lt;/p&gt;

&lt;p&gt;现实中实际使用的TCP/IP协议簇的样子–五层模型：&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/TCP:IP协议簇.png&quot; alt=&quot;TCP/IP协议簇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;问题1&lt;/strong&gt; 为什么TCP/IP协议要进行分层，有哪些好处以及坏处？&lt;/p&gt;

&lt;p&gt;A：…&lt;/p&gt;

&lt;h4 id=&quot;模块通信&quot;&gt;模块通信&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/img/OSI模块通信.png&quot; alt=&quot;OSI模块通信&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;从模块通信再看地址栏中输入wwwbaiducom&quot;&gt;从模块通信再看地址栏中输入www.baidu.com&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;软件通信方式大致分为2类：电路交换和分组交换。TCP/IP 采用的是分组交换协议。

1. 用户在地址栏中输入地址
2. 本机请求DNS域名服务器获取到对应IP（DNS工作机制--逐渐往上层查询）
3. 在运输层中选择何种协议进行数据传输，并且发送端口号（识别应用）、目标端口号记录在TCP首部或者UDP首部。并将数据进行切分为数据段。
4. 在网络层进行IP寻址、路由（寻径）、IP的分包和组包，组包过程中会填充源IP地址和目标地址
5. 数据链路层 以太网帧格式中会填充源MAC地址和目的MAC地址（帧即是01的数据集合）
6. 物理层将帧拆解通过光电信号进行传输
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;进阶&quot;&gt;进阶&lt;/h3&gt;

&lt;h4 id=&quot;运输层&quot;&gt;运输层&lt;/h4&gt;

&lt;h5 id=&quot;tcp&quot;&gt;TCP&lt;/h5&gt;

&lt;p&gt;特点：可以实现全双工的并且是可靠的数据传输。&lt;/p&gt;

&lt;p&gt;实现手段：校验和、序列号、确认应答（ACK）、重发控制、连接管理、窗口控制。&lt;/p&gt;

&lt;p&gt;1.连接管理中三次握手四次挥手。&lt;br /&gt;
&lt;strong&gt;问题2： 建立连接是三次，断开连接却是四次？&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/四次挥手.png&quot; alt=&quot;四次挥手&quot; /&gt;&lt;/p&gt;

&lt;p&gt;2.重发控制中的重发时间的确认。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;理想：确认应答一定能在n ms中返回。那么这个n就是。
实际：时间长短会随着数据包途径的网络情况不同而变化。
计算方式：计算往返时间以及其偏差相加重发超时时间，就是比这个总和要稍微大一点的值。
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.TCP的拥塞控制。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;udp&quot;&gt;UDP&lt;/h5&gt;

&lt;p&gt;特点：不提供复杂的控制机制，利用IP提供面向无连接的通信服务。&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;网络层&quot;&gt;网络层&lt;/h4&gt;

&lt;h5 id=&quot;路由&quot;&gt;路由&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;/img/路由控制.png&quot; alt=&quot;路由控制&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;数据链路层&quot;&gt;数据链路层&lt;/h4&gt;

&lt;h5 id=&quot;共享介质网络&quot;&gt;共享介质网络&lt;/h5&gt;

&lt;p&gt;特点：多个设备共享一个通信介质的一种网络。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;介质访问控制方式： &lt;br /&gt;&lt;/p&gt;

&lt;p&gt;1、争用方式。采用先到先得的方式占用信道发送数据，如果多站同时发送帧，则会产生冲突现象。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/共享介质网络.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;解决： CSMA/CD 方式，发送数据帧前检查信道，没有数据流动则任何站都可以发送数据，如果产生冲突，则立刻释放载波信道，放弃一段随机时间后再重新争用介质，重新发送。&lt;/p&gt;

&lt;p&gt;2、令牌传递方式&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;特点：令牌传递方式是沿着令牌环发送一种叫做令牌的特殊报文，只有获得了令牌才能发送数据。&lt;/p&gt;

&lt;p&gt;解决了哪些问题：1、不会产生冲突 2、每个站都有通过平等循环获得令牌的机会。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;问题： 在网络拥堵的情况下数据链路的利用率达不到100%。&lt;/p&gt;

&lt;h5 id=&quot;非共享介质网络&quot;&gt;非共享介质网络&lt;/h5&gt;

&lt;p&gt;特点：不共享介质，对介质采用专用的一种传输控制方式，在此种方式下，网络的每个站直连交换机，由交换机负责转发数据帧。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;问题：一旦交换机出问题，与之相连的计算机都将无法通信。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/非共享介质网络.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;以太网的连接形式&quot;&gt;以太网的连接形式&lt;/h5&gt;

&lt;p&gt;发展历程： 由多台终端使用同一根同轴电缆的共享介质行的连接方式 =&amp;gt; 一般采用终端与交换机之间独占电缆的方式实现以太网通信。&lt;/p&gt;

&lt;h3 id=&quot;问题&quot;&gt;问题&lt;/h3&gt;

&lt;h4 id=&quot;问题1为什么tcpip协议要进行分层有哪些好处以及坏处&quot;&gt;问题1：为什么TCP/IP协议要进行分层，有哪些好处以及坏处？&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;优势：
1. 每一层都是独立的，即是某些层发生变化，也不会波及整个系统。
2. 通过细分通信功能，更易于单独实现每个分层的协议。

劣势：
1. 可能导致过分模块化，使处理变得更加沉重。
2. 每个模块可能不得不实现相似的处理逻辑。

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;问题2建立连接是三次断开连接却是四次&quot;&gt;问题2：建立连接是三次，断开连接却是四次？&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;建立连接时，被动方服务器端结束CLOSED阶段进入“握手”阶段并不需要任何准备，可以直接返回SYN和ACK报文，开始建立连接。
释放连接时，被动方服务器，突然收到主动方客户端释放连接的请求时并不能立即释放连接，因为还有必要的数据需要处理，所以服务器先返回ACK确认收到报文，经过CLOSE-WAIT阶段准备好释放连接之后，才能返回FIN释放连接报文。
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Thu, 03 Dec 2020 20:12:00 +0800</pubDate>
        <link>http://localhost:4000/2020/12/03/network-tcpip/</link>
        <guid isPermaLink="true">http://localhost:4000/2020/12/03/network-tcpip/</guid>
        
        <category>网络</category>
        
        <category>TCP</category>
        
        <category>IP</category>
        
        
      </item>
    
      <item>
        <title>2020年年度总结</title>
        <description>&lt;p&gt;2020年是一个魔幻的一年。说起魔幻是因为确实见证了很多的第一次，第一次千万人口级别的封城、高考延期等等……&lt;br /&gt;
个人的命运无法挣脱外部环境的影响，这是每个身处其中的人们无法回避的事实。&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;总有一条蜿蜒在童话镇里的河&quot;&gt;总有一条蜿蜒在童话镇里的河&lt;/h2&gt;

&lt;p&gt;如果说2019年的主旋律是转，那么今年的主旋律是平。先说结论，今年做出了一些尝试，做了一些事情，但是依旧在许多事情上没能在进一步。
生活上，慢慢走出了迷雾。工作上虽有一些不尽人意的地方，但是也慢慢学会了与自己和解，努力修正。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;特别感谢巫师财经在年初发的一个视频。借以此视频的相关图表以及相关数据获得了5位数的理财收益，年化收益率也达到了一个比较高的数字。当然个人十分清晰的
知道，这成绩大部分是今年这个神奇般的年份赋予的，当然也有一部分归于个人敏锐的信息辨识能力。&lt;br /&gt;
阅读一直以来是没有落下的，今年为了让自己走出困境，主要是对一些心理学的书籍进行了阅读。不得不承认，心理学知识是非常必要的，这个物质生活极大满足的社会，精神的富足难能可贵，急躁的脚本在每一个行业出现，社会上不时有人在贩卖焦虑，借以收割那些急躁的人。说到阅读，今年是第一年我产生了对它异常的眼光的一年，为何这么说，缘起一次和好友的对话，《影响力》这本书即是让我产生异样眼光的原因。&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;听说疯帽喜欢爱丽丝&quot;&gt;听说疯帽喜欢爱丽丝&lt;/h2&gt;

&lt;p&gt;年初大致拟定了如下的计划：&lt;br /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;6本+技术书籍&lt;/li&gt;
  &lt;li&gt;6本+非技术书籍&lt;/li&gt;
  &lt;li&gt;软考中级证书&lt;/li&gt;
  &lt;li&gt;坚持锻炼100天&lt;/li&gt;
  &lt;li&gt;体重到135&lt;/li&gt;
  &lt;li&gt;思考进xx的方式&lt;/li&gt;
  &lt;li&gt;爬泰山或者去成都&lt;/li&gt;
  &lt;li&gt;上海居住证&lt;/li&gt;
  &lt;li&gt;开始写作，并尝试向任何一个出版社投稿&lt;/li&gt;
  &lt;li&gt;理财相关（储蓄目标完成度）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从两方面来分析今年的完成情况：&lt;br /&gt;
1、学习。全年在专业领域和非专业领域上投入时间整体相当。上半年对心理学较为感兴趣阅读了《非暴力沟通》、《影响力》、《亲密关系》等书籍，在之后的时间中个人对工作有所怀疑与迷茫，原因是自己在某一些领域尝到一些甜头试图继续探究，去翻了下《穷查理宝典》明晰了本末。专业领域上，主要是阅读了一些Java技术栈的书籍和视频，诸如《Java核心技术卷》、《Maven实战》、《Spring实战》等。临近岁末也搭了一下公司内部的新的测试环境，部署相关的构件。&lt;br /&gt;
2、生活。最开心的当然就是登顶玉皇顶了，独自登高感觉很爽。遗憾的是体重没有达标，这也连续第二年体重没有达标了，美食总是给人温暖，难以抗拒。&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;丑小鸭会变成美丽的白天鹅&quot;&gt;丑小鸭会变成美丽的白天鹅&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;恶意（日 东野圭吾）&lt;/li&gt;
  &lt;li&gt;月亮与六便士 （英 威廉·萨默塞特·毛姆）&lt;/li&gt;
  &lt;li&gt;非暴力沟通 (美 马歇尔·卢森堡)&lt;/li&gt;
  &lt;li&gt;浮生六记 （沈复）&lt;/li&gt;
  &lt;li&gt;小狗钱钱 （德 博多·舍费尔）&lt;/li&gt;
  &lt;li&gt;墨菲定律&lt;/li&gt;
  &lt;li&gt;钢铁、枪炮和病菌（美 贾雷德·戴蒙德）&lt;/li&gt;
  &lt;li&gt;山月记 （日 中岛敦）&lt;/li&gt;
  &lt;li&gt;影响力 （美 罗伯特·西奥迪尼）&lt;/li&gt;
  &lt;li&gt;穷查理宝典 （美 考夫曼）&lt;/li&gt;
  &lt;li&gt;老人与海 （美 海鸣威）&lt;/li&gt;
  &lt;li&gt;万历十五年 （美籍华人 黄仁宇）&lt;/li&gt;
  &lt;li&gt;低智商社会 （日 大前研一）&lt;/li&gt;
  &lt;li&gt;解读中国经济 （林毅夫）&lt;/li&gt;
  &lt;li&gt;如何阅读一本书 （美 莫提默·J. 艾德勒、查尔斯·范多伦）&lt;/li&gt;
  &lt;li&gt;大江东去（阿耐)&lt;/li&gt;
  &lt;li&gt;图解TCP/IP&lt;/li&gt;
  &lt;li&gt;软件设计师教程&lt;/li&gt;
  &lt;li&gt;Java核心技术卷一第十版&lt;/li&gt;
  &lt;li&gt;Maven实战&lt;/li&gt;
  &lt;li&gt;Java开发手册&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;只有睿智的河水知道&quot;&gt;只有睿智的河水知道&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;书之于人，有好坏之分。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;吾尝终日而思矣，不如须臾之所学也。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;赌博最大的危害在于一旦人尝到了赚快钱的快感，他是不愿意去工作赚慢钱的。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;黄赌毒中的黄和赌是不分家，一旦染上其一大概率会染上另一个。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;即使在不舍也没用，尽力而为不留遗憾。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;把整个社会比之于一根树，这棵树上会有一些成熟的果子，空气中浸润着它们成熟的气息。也会有一些青色的果子，假以时日它们也会成熟。但是这树上还有一大部分已经快风干脱落的枳。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;阅读本身也是一个流程化的过程，既然是流程化的过程，也会有其标准。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;事事都求逻辑性显然这很不符合逻辑，就像这次总结。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 03 Dec 2020 20:12:00 +0800</pubDate>
        <link>http://localhost:4000/2020/12/03/summary/</link>
        <guid isPermaLink="true">http://localhost:4000/2020/12/03/summary/</guid>
        
        <category>年度总结</category>
        
        
      </item>
    
      <item>
        <title>对称加密-AES</title>
        <description>&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;

&lt;p&gt;  最近宇哥排查到了一个很匪夷所思的事情。部分小程序接口请求某个接口但是响应莫名其妙被置为空。后面排查到是被 TX 给劫持了，具体被劫持的原因，那次请求中有一个 url(指向七牛云上的图片资源)，应该 TX 拿到了那个资源并且识别到了图片上的“京东”这两个字眼，然后就发生了之后的事情。心疼我东哥 1 东(1 东===2min)。后面宇哥就交代了我们这边的接口提供方要求对数据进行加密。&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;处理思路&quot;&gt;处理思路&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;需求&lt;/strong&gt; &lt;br /&gt;
  1、对数据进行加密&lt;br /&gt;
  2、加密过程不要太过复杂&lt;br /&gt;
  3、对接口响应时间不会造成太大的影响（避免响应时间大幅度增加）&lt;br /&gt;
  4、灵活配置&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;着手&lt;/strong&gt; &lt;br /&gt;
  1、首先确定加密方向。因为不能太过复杂，所以最好采用对称加密。个人觉得有必要像组合加密机制那样先用非对称加密加密对称加密的密钥（撇开中间人攻击），但是后面是采用在前后端都维护一个密钥数组。&lt;br /&gt;
  2、选中对称加密，对称加密算法选择，Aes 是典型的加密算法。而且 node 核心模块 crypto 也支持。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;实现&lt;/strong&gt; &lt;br /&gt;
  1、打算在服务器端和客户端这边维护一些密钥数组和加密向量数组为的是稍微提高些安全性。&lt;br /&gt;
  2、加密密钥和加密向量的定位值不应该是明文。采用位运算对实际下标值进行某种位运算进行偏移。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;代码&lt;/strong&gt;&lt;br /&gt;&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cm&quot;&gt;/*
 * @Descripttion: aes加密测试
 * @version:1.0
 * @Author: want
 * @Date: 2019-08-09 10:44:25
 * @LastEditors: want
 * @LastEditTime: 2019-08-12 09:33:01
 */&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 加密方法
 * @param {String}      加密key
 * @param {String}       向量
 * @param {String}      需要加密的数据
 * @returns string 密文
 */&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encrypt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createCipheriv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;aes-128-cbc&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;final&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * @name: 解密方法
 * @msg: 对密文进行解密
 * @param {String}  解密算法
 * @param {String}   解密向量
 * @param {String} 密文
 * @return: 解密后的数据
 */&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decrypt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createDecipheriv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;aes-128-cbc&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;final&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;(IJf621ea5c0ok8j&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`key:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;02kk950004598718&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`iv:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;want dddd&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;数据加密后:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;数据解密后:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * k: ['751f621ea5c8f930','751f621ea5c0ok8j','@#$898js8.9ksj8j']
 *
 * iv:['2624750004598718','02kk950004598718','9s82,.9#$%hjjHJF']
 *
 */&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;困惑&lt;/strong&gt; &lt;br /&gt;
  1、加密向量感觉很废。
  2、加密向量为啥长度有要求，为啥是 16 位？&lt;/p&gt;

&lt;h4 id=&quot;aes-细细讲来&quot;&gt;Aes 细细讲来&lt;/h4&gt;

&lt;p&gt;高级加密标准（Advanced Encryption Standard: AES）是美国国家标准与技术研究院（NIST）在 2001 年建立了电子数据的加密规范。其是对称加解密算法的最经典算法之一，它是一种分组加密标准，每个加密块大小为 128 位，允许的密钥长度为 128、192 和 256 位。&lt;br /&gt;&lt;/p&gt;

&lt;!-- 这里只介绍 ECB、CBC、CFB 和 OFB 四种加密模式。 --&gt;

&lt;p&gt;&lt;strong&gt;Aes 算法三个特点：&lt;/strong&gt;&lt;br /&gt;
1、密钥。密钥是 AES 算法实现加密和解密的根本。对称加密算法之所以对称，是因为这类算法对明文的加密和解密需要使用同一个密钥。AES 支持三种长度的密钥。分别是：128 位、192 位、256 位。密钥位数越多加密轮数越多、也就越安全，但是也会导致性能的下降。&lt;br /&gt;
2、填充。常见的填充：NoPadding（要求明文必须是 16 字节的整数倍）、PKCS5Padding（如果明文块少于 16 个字节，则再明文末尾补足相应数量的字符）、ISO10126Padding（在明文块末尾补足相应数字的字节，最后一个字符值等于缺少的字符数，其他字符填充随机数）。值得注意的是在 AES 加密的时候使用了某一种填充方式，解密的时候也必须采用相同的填充方式。&lt;br /&gt;
3、模式。常见的模式有：ECB(电子密码本)、CBC(密码块连接)、CTR（计算器模式）、CFB(密码反馈方式) 和 OFB(输出反馈方式)、PCBC(填充密码块链接)。所有工作模式的差别体现在宏观上，即明文块与明文块之间的关联。AES 加密器的内部处理流程都是相同的。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ECB 电子密码本模式是最简单的加密模式，加密前根据加密块的大小（AES 为 128 位）分成若干块，之后将每块使用相同的密钥单独加密，解密同理。&lt;br /&gt;
ECB 因为每块数据的加密是独立的因此加密和解密都可以并行计算。ECB 最大的问题是相同的明文快回被加密成相同的密文，在某些特俗环境并不能提供严格的数据保密性。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;CBC 模式又称之为密码分组链接：CBC 模式对于每个待加密的密码块在加密前会先与前一个密码块的密文进行异或然后再用加密器进行加密。显然第一个密码块是没有前一个的密文与之进行异或操作的，所以其采用的是第一个明文块与一个初始化向量（IV）的数据块进行异或操作。&lt;br /&gt;
AES_cbc_encrypt 允许 length 不是 16(128 位)的整数倍，不足的部分会用 0 填充，输出总是 16 的整数倍。完成加密或解密后会更新初始化向量 IV。CBC 模式相比 ECB 有更高的保密性，但由于对每个数据块的加密依赖与前一个数据块的加密所以加密无法并行。与 ECB 一样在加密前需要对数据进行填充，不是很适合对流数据进行加密。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;CFB 又称为面反馈模式，其与 ECB、CBC 不同的是 CFB 能够将密文转换为流密文。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;OFB 模式又称输出反馈模式（Output feedback）：OFB 是先用块加密器生成密钥流（Keystream），然后再将密钥流与明文流异或得到密文流，解密是先用块加密器生成密钥流，再将密钥流与密文流异或得到明文，由于异或操作的对称性所以加密和解密的流程是完全一样的。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;关于填充&lt;/strong&gt;&lt;br /&gt;
需要了解分组加密特性，何为分组加密，在密码学中分组加密又称之为分块加密或者块密码，是一种对称加密算法。它将明文分为多个等长的模块，使用确定的算法和对称密钥对每组分别加密解密。有一个问题，因为 AES 加密算法是会将明文拆分为一个个独立的明文块，那么显然可能会存在最后一个明文块长度达不到标准，如果出现这种情况就需要对明文进行填充处理。&lt;br /&gt;
&lt;strong&gt;常见的填充处理方式&lt;/strong&gt;&lt;br /&gt;
1、NoPadding： 不做任何填充，但是明文必须是指定块长度的整数倍。&lt;br /&gt;
2、PKCS5Padding(默认):如果明文块少于 16 个字节（128bit），在明文块末尾补足相应数量的字符，且每个字节的值等于缺少的字符数。&lt;br /&gt;
3、ISO10126Padding:如果明文块少于 16 个字节（128bit），在明文块末尾补足相应数量的字节，最后一个字符值等于缺少的字符数，其他字符填充随机数。&lt;br /&gt;
&lt;br /&gt;
&lt;strong&gt;AES 整体关系图&lt;/strong&gt;&lt;br /&gt;
1、把明文按照 128bit 拆分为若干个明文块。&lt;br /&gt;
2、按照选择的填充方式来填充最后一个明文块。&lt;br /&gt;
3、每一个明文块利用 AES 加密器和密钥，加密成密文块。&lt;br /&gt;
4、拼接所有的密文块，成为最终的密文结果。&lt;br /&gt;
&lt;img src=&quot;/img/Aes加密.png&quot; alt=&quot;整体关系图&quot; /&gt;
&lt;strong&gt;AES 加密器剖析&lt;/strong&gt;
AES 不是一次把明文变成密文，而是经过很多轮加密。大致可以分为：&lt;br /&gt;
初始轮 1 次+普通轮 N 次+最终轮 1 次。之前提到 AES 的 key（密钥） 支持三种长度：AES128、AES192、AES256。key 的长度决定轮 AES 加密的轮数。&lt;br /&gt;
出去初始轮，各种 key 长度对应的轮数如下:&lt;br /&gt;
AES128 – 10 轮 – 8 次普通轮&lt;br /&gt;
AES192 – 12 轮 – 10 次普通轮&lt;br /&gt;
AES256 – 14 轮 – 12 次普通轮&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;初始轮只有一个步骤：加轮密钥。&lt;br /&gt;
普通轮有四个步骤：1、字节代替。2、行移位。3、列混淆。4、加轮密钥。&lt;br /&gt;
最终轮有三个步骤：1、字节代替。2、行移位。3、加轮密钥。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;字节代替&lt;/em&gt;&lt;br /&gt;
16 个字节在明文块在每一个处理步骤中都被排列成 4*4 的二维数组。所谓的字节代替就是把明文块的每一个字节都替代成另外一个字节。替代的依据一个被称为 S 盒的 16*16 的二维常量数组。
假设明文块中 a[2][3] = 5A;那么输出值 b[2,3] = S[5][10]。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;行移位&lt;/em&gt;&lt;br /&gt;
二维矩阵，第一行不动。第二行循环左移动 1 个字节。第三行循环左移 2 个字节。第 4 行循环左移 3 个字节。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;列混淆&lt;/em&gt;&lt;br /&gt;
输入数组的每一列要和一个名为修补举证的二维常量数组做矩阵相乘得到对应的输出列。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;加轮密钥&lt;/em&gt;&lt;br /&gt;
128bit 的密钥也被同样排列成 4*4 的矩阵。让输入数组的每一个字节 a[i][j]与密钥对应位置的字节 k[i][j]异或一次，就生成了输出值 b[i,j]。需要注意的是：加密的每一轮所用到的密钥并不是相同的，这里涉及到一个概念：扩展密钥。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;扩展密钥&lt;/em&gt;&lt;br /&gt;
AES 源代码中用长度 4 _ 4 _（10+1） 字节的数组 W 来存储所有轮的密钥。W{0-15}的值等同于原始密钥的值，用于为初始轮做处理。后续每一个元素 W[i]都是由 W[i-4]和 W[i-1]计算而来，直到数组 W 的所有元素都赋值完成。W 数组当中，W{0-15}用于初始轮的处理，W{16-31}用于第 1 轮的处理，W{32-47}用于第 2 轮的处理 ……一直到 W{160-175}用于最终轮（第 10 轮）的处理。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;至此加密流程全部走完。解密的过程就是加密的逆过程不再坠述。&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;遇到的问题&quot;&gt;遇到的问题&lt;/h4&gt;

&lt;p&gt;在前端同事进行联调的时候发现，数据量少的情况，前端是可以对后端的密文进行正常解密的，但是当后端提供的密文很长的时候，前端解密的时候就会出现无法解密的情况。
经过排查发现，因为后端加密采用的是 node 的核心模块中的 crypto，但是前端用的是 crypto-js。最终解决是后端也采用 crypto-js 这个模块进行加密操作。&lt;br /&gt;
最近加密又出了问题。原因是crypto-js这个module在针对包含%的明文的时候加密会报错。根本原因是在decodeURI转码时，通过%进行解析，如果字符串中存在%则会出现URI malformed。最后的解决办法是采用另一种加密形式。其实只要把明文转为TX识别不出的密文并且可以通过某种方式解密出来即可。&lt;/p&gt;
&lt;h4 id=&quot;回头看看&quot;&gt;回头看看&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;解答&lt;/strong&gt;&lt;br /&gt;
1、解答：iv 的作用是在 CBC 加密模式的情况下与第一个明文块进行异步操作的。&lt;br /&gt;
2、解答：AES 是一种分组加密标准，每个加密块大小为 128 位，允许的密钥长度为 128、192 和 256 位。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;知识收集&lt;/strong&gt;&lt;br /&gt;
1、http://www.361way.com/aes/5830.html&lt;br /&gt;
2、https://zhuanlan.zhihu.com/p/45155135&lt;br /&gt;
3、https://en.wikipedia.org/wiki/Advanced_Encryption_Standard&lt;br /&gt;
4、https://www.zybuluo.com/coldxiangyu/note/796980&lt;br /&gt;
5、https://blog.csdn.net/Vieri_32/article/details/48345023&lt;br /&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 10 Aug 2019 06:09:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/10/Aes/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/10/Aes/</guid>
        
        <category>AES</category>
        
        
      </item>
    
      <item>
        <title>MongoDB使用整理</title>
        <description>&lt;p&gt;  MongoDB 是非关系型数据库的典型。官网对它的描述是：基于分布式文件存储的数据库，其拥有高性能、可扩展、易部署、易使用，存储数据非常方便等优势。&lt;br /&gt;
本文旨在列举实际工作中常用到的一些知识点，以及其相关的扩展知识。系统的学习请参阅官方文档。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;优势：&lt;br /&gt;
  1、文档型NoSQL数据库。数据以文档的形式在MongoDB中保存，文档实际就是JSON字符串，JSON字符串容易阅读，且主流的计算机语言对其有很好的支持。&lt;br /&gt;
  2、基于文档的灵活的数据模式。相比MySQL，无需使用DDL对表结构进行修改。&lt;br /&gt;
  3、强大的索引能力。支持一级、二级、TTL索引和地理位置索引等。&lt;br /&gt;
  4、强大的扩展能力。分片机制用于实现业务的水平扩展，每个分片只保留业务的部分数据，并且支持副本集，确保分片上的数据的高可用性。&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;适用的业务场景&quot;&gt;适用的业务场景&lt;/h2&gt;

&lt;p&gt;  1、敏捷迭代的业务，需求变动频繁，数据模型无法确定。&lt;br /&gt;
  2、存储的数据格式灵活，不固定 ，或属于半结构化数据。&lt;br /&gt;
  3、对数据高可用性有高要求。&lt;br /&gt;
  4、需要大量的地理位置查询、文本查询。&lt;br /&gt;
  5、无需跨文档或跨表的事物及复杂的join查询支持。（4.0之后支持多文档事物，多文档事物可以理解为关系型数据库的多行事物。）&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;内容&quot;&gt;内容&lt;/h2&gt;
&lt;h4 id=&quot;schema定义实践&quot;&gt;Schema定义实践&lt;/h4&gt;
&lt;p&gt;针对表结构定义这件事而言，重要的应该是仔细。扣原型上的每一个地方，当然出于一些功能上的实现，我们也需要再补充一些字段。&lt;br /&gt;
1、表名的确定。大部分还是跟业务涉及的实体对应。&lt;br /&gt;
2、字段名称要符合规范。复数字段对应的字段名称必须是复数。&lt;br /&gt;
3、对一些不太会进行修改的引用字段可以考虑内嵌一些常用的冗余属性。比如说商品表、标签表。商品表中有一个字段tags。那么可以考虑将tags定义成如下所示的结构，因为业务上对标签显示最多的只有对其名称的显示。&lt;br /&gt;&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;ObjectId&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Tag&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}],&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 标签&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;4、功能性一致的字段，用一个对象进行内嵌，而非水平的展开结构。比如说一张表有许多统计字段，可以将这些字段统一规整到statistics字段下。&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;curd-简诉&quot;&gt;CURD 简诉&lt;/h4&gt;

&lt;p&gt;  其查询语法跟 MySQL 的 SQL 是存在很大区别的。个人在刚刚开始写的时候感觉很难记。其实它的查询语法异常简单。后面会想起来感觉所接触到的几个非关系型数据库都是这个套路，即查询语句中的条件跟存储的数据的数据结构高度相关。&lt;/p&gt;

&lt;p&gt;举例：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;documents:
[
    {
        name:'want',
        age:23,
        hobby:['chang', 'tiao', 'rap', 'lanqiu'],
    },
    {
        name:'haixing',
        age:23,
        hobby:['game', 'eat', 'study', 'acm'],
    },
    {
        name:'xuejun',
        age:23,
        hobby:['reading', 'study'],
    },
    {
        name:'xidada',
        age:23,
        hobby:['reading', 'game'],
    }
]
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;查询的时候比方说要查年龄大于 22 并且喜欢的学习（study）的人。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;db.getCollection.user.find({})。find中的{}就是我们要匹配的文档。
那么我们将条件进行填充即可。
{
    age:{ $gt:22},
    hobby:'study' //因为hobby是数组，也可以这么限定：hobby:{$in:['study']}
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;查询条件默认是&amp;amp;&amp;amp;的逻辑，如果想用或的逻辑使用 &lt;strong&gt;$or&lt;/strong&gt; 挂到查询对象上。&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;$or&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$gt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}],&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;hobby&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;study&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;等同与MySQL中的&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hobby&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;study&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;age&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;age&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;mongoose&quot;&gt;mongoose&lt;/h4&gt;
&lt;p&gt;  mongoose是一个主流操作MongoDB的node模块。&lt;a href=&quot;https://mongoosejs.com/docs/&quot;&gt;mongoose官方文档&lt;/a&gt;&lt;br /&gt;
  mongoose为模型提供了一种直接的，基于scheme结构去定义你的数据模型。它内置数据验证， 查询构建，业务逻辑钩子等，开箱即用。&lt;br /&gt;
  整理:&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;mongoose的find不同于aggregate方法&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;前者会自动将一个是ObjectId的字符串转为ObjectId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;亦或是将一个moment对象转为Date类型&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;后者则需要手动的去转换&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;理解aggregate&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;这个应该算是MongoDB的东西&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;官方文档上有这么一段话&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;：&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;The&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aggregation&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pipeline&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;framework&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aggregation&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;modeled&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;concept&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;processing&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pipelines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Documents&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;enter&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;multi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stage&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pipeline&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;transforms&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;documents&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;aggregated&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;翻译过来就是&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;聚合管道是基于数据处理管道概念建模的数据聚合框架&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;文档进入多阶段流水线&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;该流水线将文档转换为汇总结果&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;个人理解&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;：&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;aggregate就是对指定数据&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;（&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;满足$match条件&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;）&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;串行的执行其中定义的操作的过程&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;aggregate的参数是一个数组&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;结合文档所说其实每一个元素就是一个阶段&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;每个阶段我们可以对上阶段处理完的数据进行本阶段定义好的方式去加工数据&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;populate方法&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;多层填充&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;。&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;例子&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;findOne&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;populate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;populate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;populate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;avatar&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//填充children后再针对children的avatar再进行填充。&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;索引的问题&quot;&gt;索引的问题&lt;/h4&gt;

&lt;p&gt;由于索引是存储在内存(RAM)中,你应该确保该索引的大小不超过内存的限制。
如果索引的大小大于内存的限制，MongoDB 会删除一些索引，这将导致性能下降。&lt;/p&gt;

&lt;p&gt;检测是否使用索引（官方文档上写了三种方式）：&lt;strong&gt;explain()&lt;/strong&gt;&lt;br /&gt;
查询计划解读&lt;a href=&quot;https://docs.mongodb.com/manual/reference/explain-results/index.html&quot;&gt;MongoDB官方文档传送门&lt;/a&gt;：&lt;br /&gt;
&lt;img src=&quot;/img/mongoExplain.png&quot; alt=&quot;执行计划结果图&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; queryplanner: 详细的说明了查询优化器选择的计划，queryplanner模式下并不会真正的执行query语句查询，而是针对query语句进行执行计划分析选出winning plan。
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; namespace: query所查询的表
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; indexFilterSet: 这个查询是否应用了索引过滤器。（看query有没有用索引不能看这个）
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; winningplan: 查询优化器针对这次query所返回的最优执行计划的详细内容
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; stage: 最优执行计划的stage有以下几个类型：
&lt;span class=&quot;p&quot;&gt;    -&lt;/span&gt; COLLSCAN: 全表扫描
&lt;span class=&quot;p&quot;&gt;    -&lt;/span&gt; IXSCAN: 索引扫描
&lt;span class=&quot;p&quot;&gt;    -&lt;/span&gt; FETCH: 根据索引去检索制定文档
&lt;span class=&quot;p&quot;&gt;    -&lt;/span&gt; SHARD_MERGE: 将各个分片返回数据进行merge
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; filter: 过滤条件
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; inputStage:
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; keyPattern:
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; indexName: winning plan所选用的index
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; isMultiKey: 是否是
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; direction: 查询顺序
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; rejectedPlans: 其他非最优执行计划
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; executionStats
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; executionSuccess: 是否执行成功
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; nReturned: 返回的数据条数
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; executionTimeMillis: 执行时间(越少越好)
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; totalKeysExamined: 索引扫描次数
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; totalDocsExamined: 文档扫描次数
&lt;span class=&quot;p&quot;&gt; -&lt;/span&gt; executionStages
&lt;span class=&quot;p&quot;&gt;  -&lt;/span&gt; ...
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;索引的最大范围：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;1、集合中索引不能超过 64 个&lt;/li&gt;
  &lt;li&gt;2、索引名的长度不能超过 128 个字符&lt;/li&gt;
  &lt;li&gt;3、一个复合索引最多可以有 31 个字段&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;刚刚开始建 schema 的时候没必要过多的索引的，后面有需要再建索引。至于出现索引数据过大的情况，可以使用stats()方法进行协助查看各个索引的存储占用情况，针对不必要的索引进行清理即可。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;mongoose创建索引：&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c1&quot;&gt;//_id自带索引&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;field&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 1为指定按升序创建索引，-1为降序创建索引。&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;field&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fieldB&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//多字段索引&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;可选参数列表：
&lt;img src=&quot;/img/indexOpt.png&quot; alt=&quot;可选参数&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;关联表&quot;&gt;关联表&lt;/h4&gt;
&lt;p&gt;通过3.2版本的新功能$lookup来进行。&lt;br /&gt;
语法：&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
   $lookup:
     {
       from: &amp;lt;collection to join&amp;gt;, //指定要执行联结的集合
       localField: &amp;lt;field from the input documents&amp;gt;, // 
       foreignField: &amp;lt;field from the documents of the &quot;from&quot; collection&amp;gt;, //指定from文档中的字段
       as: &amp;lt;output array field&amp;gt; //指定要添加到输入文档中的新数组字段的名称。
     }
}

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;例子：&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;const res = await models.Xxx.aggregate([
    { $match: query },
    { $group: { _id: '$tags' } },
    { $lookup: { from: 'tags', localField: '_id', foreignField: '_id', as: 'tags' } },
    // 关联后再做筛选
    { $match: { 'tags.name': { $all: tags_arr } } },
    { $project: { _id: 1 } },
]);
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;如果你使用的ORM的包是mongoose的话，请使用Query的populate方法。相关使用详情参阅：&lt;a href=&quot;https://mongoosejs.com/docs/api/query.html#query_Query-populate&quot;&gt;文档&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;正则表达式&quot;&gt;正则表达式&lt;/h4&gt;
&lt;p&gt;MongoDB 使用 $regex 操作符来设置匹配字符串的正则表达式。
MongoDB使用PCRE (Perl Compatible Regular Expression) 作为正则表达式语言。
不同于全文检索（2.6 版本以后需要开启相关配置:db.adminCommand({setParameter:true,textSearchEnabled:true})），我们使用正则表达式不需要做任何配置。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;使用：&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;$regex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;xxx&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}})&lt;/span&gt; 
&lt;span class=&quot;nx&quot;&gt;或者&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/xxx/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//不区分大小写&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;$regex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;xxx&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;$options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}})&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 还支持在数组字段中使用正则表达式来查找内容 tags为数组字段&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;$regex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;xxx&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}})&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;注意：正则中使用变量。需要使用eval将组合的字符串进行转换，不能直接将字符串拼接后传入正则表达式。&lt;br /&gt;&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;变量值key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/i&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/i&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// 等同于 title:{$regex:title,$Option:&quot;$i&quot;}   &lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;相关书籍&quot;&gt;相关书籍&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;《深入学习MongDB》&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;1、取最值的方式：a、通过聚合然后使用一些提供的方法拿 b、[推荐使用]对某个字段进行排序然后取第一个。&lt;br /&gt;
2、索引一般用在返回结果总是总体数据的一小部分的时候。一旦返回的数据较大（举例：超过了集合的一半）就不要用索引了。&lt;br /&gt;
3、可以使用 $natural 来禁用掉索引。&lt;br /&gt;
4、建立分级文档加快扫描（实际用的不多感觉）。&lt;br /&gt;
5、AND 型查询，查询条件越苛刻（匹配最少数据量的条件）越放在前面，减少数据量。&lt;br /&gt;
6、OR 型查询，查询条件越宽泛（匹配最多数据量的条件）越放在前面。&lt;br /&gt;
7、在collection在256G之前进行分片&lt;/p&gt;

&lt;h2 id=&quot;后记&quot;&gt;后记&lt;/h2&gt;
&lt;h4 id=&quot;mongodb和关系型数据库的核心区别&quot;&gt;MongoDB和关系型数据库的核心区别&lt;/h4&gt;
&lt;p&gt;核心区别就是：文档模型。&lt;br /&gt;
关系模型需要我们把一个数据对象拆分成许多个单项。然后存到各个相应的表中，需要的时候通过查询将所需要的数据从各个表中查询出来。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;MongoDB的文档模式。文档模式存储单位是一个文档，可以支持数组和嵌套文档。在MongoDB中利用富文档的性质，很多时候，关联是一个伪需求，可以通过合理建模来避免。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;文档模型的优点：&lt;br /&gt;
1、效率高。文档模型将数据集中到来一起，在普通机械盘中不需要在额外的移动磁头。&lt;br /&gt;
2、可扩展性强。如果不考虑关联，数据分区分库，水平扩展简单。&lt;br /&gt;
3、动态模式。文档模型支持可变数据模式，不要求每个文档都要有一样的数据结构，对很多异构数据场景支持较好。&lt;br /&gt;
4、模型自然。最为接近对象模型。&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;文档模式设计的基本策略：&lt;br /&gt;
一般先考虑内嵌，一般的一对一、一对多关系都可以放在一个文档中使用内嵌进行解决。&lt;br /&gt;
实在不行使用引用，即在主表中存储一个ID值指向另一张表的的ID值，从性能上来说我们一般需要两次以上的查询才能把相关的数据取到。&lt;br /&gt;
更加重要的是MongoDB暂时还不支持跨表的事务，所以对强事务场景需要谨慎使用。（4.0版本发布后MongoDB支持原生的事务操作）&lt;br /&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 09 Aug 2019 06:09:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/09/mongodb/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/09/mongodb/</guid>
        
        <category>数据库</category>
        
        <category>MongoDB</category>
        
        
      </item>
    
  </channel>
</rss>
